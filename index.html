<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
  <title>Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ø¨Ø§Ø²Ø±Ø³ÛŒ Ùˆ Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±</title>
  <link rel="manifest" href="manifest.json">
  <style>
    /* ===== Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ ===== */
    :root {
      --primary: #0a7bdc; --primary-dark: #0d47a1; --accent: #1976d2; --muted: #90caf9;
      --success: #2e7d32; --warning: #f57c00; --danger: #c62828;
      --bgA: #eaf6ff; --bgB: #d8ecff; --card: #fff;
      --bg: #f3f6fb;
    }
    
    html, body {
      height: 100%; margin: 0; padding: 0; 
      font-family: Tahoma, Arial, system-ui, sans-serif;
      direction: rtl; background: var(--bg);
    }
    
    body {
      min-height: 100vh; padding: 12px; box-sizing: border-box;
    }
    
    .card {
      background: var(--card); border-radius: 12px; padding: 12px; margin-bottom: 12px;
      box-shadow: 0 6px 14px rgba(8, 34, 63, 0.06);
    }
    
    h1, h2 {
      margin: 0 0 8px; color: var(--primary-dark);
    }
    
    h1 { font-size: 20px; }
    h2 { font-size: 18px; }
    
    button {
      background: var(--primary); color: #fff; border: none; 
      padding: 12px; font-weight: 800; border-radius: 10px; cursor: pointer;
      font-size: 15px;
    }
    
    /* ===== Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ ===== */
    .main-app .muted { color: #5b7288; font-size: 14px; }
    
    .main-app .small-header {
      position: sticky; top: 0; background: #fff; padding: 8px; 
      border-bottom: 1px solid #eef3fb; z-index: 20; border-radius: 0; 
      display: flex; align-items: center; gap: 8px;
    }
    
    .main-app .pill {
      display: inline-block; background: #eef7ff; color: #0a5ea4; 
      padding: 6px 10px; border-radius: 999px; font-weight: 700;
    }
    
    .main-app .check-item {
      background: #fff; margin: 8px 0; padding: 14px; border-radius: 10px; 
      border: 1px solid #eef3fb; display: flex; flex-direction: column; gap: 8px;
    }
    
    .main-app .ci-opts {
      display: flex; gap: 10px; margin-top: 6px;
    }
    
    .main-app .ci-opts label {
      flex: 1; display: flex; align-items: center; justify-content: center; 
      padding: 12px; border-radius: 8px; background: #f6f9ff; border: 1px solid #e6eefb; 
      font-weight: 700; cursor: pointer; transition: all 0.2s ease;
    }
    
    .main-app .ci-opts label.selected {
      background: #e1f0ff; border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(10, 123, 220, 0.2);
    }
    
    .main-app .ci-opts label.ok.selected {
      background: #e8f5e8; border-color: #4caf50;
    }
    
    .main-app .ci-opts label.notok.selected {
      background: #ffebee; border-color: #f44336;
    }
    
    .main-app .ci-opts label.bulk-ok.selected {
      background: #e1f0e1; border-color: #66bb6a;
      opacity: 0.8;
    }
    
    .main-app input[type="radio"] { display: none; }
    
    .main-app .nav {
      display: flex; gap: 10px; margin-top: 12px;
    }
    
    .main-app .nav button { flex: 1; padding: 12px; }
    
    .main-app .small-ghost {
      background: #eef2f8; color: #0b3b66; border: 1px solid #d7e6fb;
    }
    
    .main-app .toolbar {
      display: flex; gap: 3px; align-items: center;
    }
    
    .main-app #checklistContainer {
      min-height: 200px; max-height: 85vh; overflow: auto; padding: 6px;
    }
    
    .main-app .location-status {
      font-size: 12px; margin-top: 4px; font-weight: 600;
      padding: 4px 8px; border-radius: 4px; background: #f5f5f5;
    }
    
    .main-app .location-status.active {
      background: #e8f5e9; color: #2e7d32;
    }
    
    .main-app .location-status.inactive {
      background: #ffebee; color: #d32f2f;
    }
    
    .main-app button:disabled {
      opacity: 0.6 !important; cursor: not-allowed !important;
    }
    
    .main-app .gps-warning {
      background: #fff3e0; border: 1px solid #ffb74d; border-radius: 8px;
      padding: 12px; margin: 10px 0; text-align: center; color: #e65100;
      font-weight: 600;
    }
    
    .main-app input, .main-app select, .main-app textarea {
      width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #d7e0ee;
      font-size: 16px; box-sizing: border-box; background: #fff;
    }

    /* ===== Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø®Ø´ Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ ===== */
    .vibration-section {
      background: #fff; padding: 16px; margin: 12px 0; border-radius: 12px; 
      border: 1px solid #eef3fb;
    }
    
    .vibration-part {
      margin-bottom: 20px; padding: 12px; background: #f8fbff; 
      border-radius: 10px; border: 1px solid #e6eefb;
    }
    
    .vibration-part:last-child { margin-bottom: 0; }
    
    .part-title {
      font-weight: 800; color: #0a5ea4; margin-bottom: 12px; 
      font-size: 16px; text-align: center;
    }
    
    .position-labels {
      display: flex; gap: 8px; margin-bottom: 8px;
    }
    
    .position-label {
      flex: 1; text-align: center; padding: 8px; background: #eef7ff; 
      border: 1px solid #d7e6fb; border-radius: 8px; font-weight: 700; 
      color: #0a5ea4; font-size: 14px;
    }
    
    .position-inputs {
      display: flex; gap: 8px; margin-bottom: 6px;
    }
    
    .vibration-input {
      flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #d7e0ee; 
      text-align: center; font-size: 15px; background: #fff; 
      font-family: Tahoma, Arial, sans-serif;
    }
    
    .vibration-input::placeholder { color: #999; text-align: center; }
    
    .unit {
      text-align: center; font-size: 12px; color: #5b7288; 
      font-weight: 600; margin-bottom: 12px;
    }
    
    .temp-section {
      display: flex; align-items: center; gap: 8px; margin-top: 12px; 
      padding-top: 12px; border-top: 1px dashed #e6eefb;
    }
    
    .temp-section label {
      font-weight: 700; color: #0a5ea4; white-space: nowrap; font-size: 14px;
    }
    
    .temp-input {
      flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #d7e0ee; 
      text-align: center; font-size: 15px; background: #fff; 
      font-family: Tahoma, Arial, sans-serif;
    }
    
    .temp-input::placeholder { color: #999; text-align: center; }

    /* ===== Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú†Ú©â€ŒØ¨Ø§Ú©Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ OK ===== */
    .select-all-container {
      margin-top: 16px; padding: 12px; background: #f8fbff; 
      border-radius: 10px; border: 2px dashed #e6eefb;
      text-align: center;
    }
    
    .select-all-checkbox {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      cursor: pointer; font-weight: 700; color: #0a5ea4;
    }
    
    .select-all-checkbox input {
      width: 20px; height: 20px; cursor: pointer;
    }
    
    .select-all-hint {
      font-size: 12px; color: #5b7288; margin-top: 4px;
      font-style: italic;
    }

    /* ===== Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢ÛŒØ¯Ù„Ø± ===== */
    .idler-app {
      display: flex; align-items: center; justify-content: center; 
      min-height: 100vh; background: linear-gradient(180deg, var(--bgA), var(--bgB));
    }
    
    .idler-app .card {
      width: 100%; max-width: 440px; background: var(--card); 
      border-radius: 14px; box-shadow: 0 8px 24px rgba(13, 47, 91, 0.10); 
      padding: 14px; box-sizing: border-box;
    }
    
    .idler-app #message {
      display: none; padding: 10px; border-radius: 10px; 
      text-align: center; font-weight: 800; margin-bottom: 8px; font-size: 13px;
    }
    
    .idler-app #message.success {
      background: #e6f4ea; color: var(--success); border: 1px solid rgba(46, 125, 50, 0.12);
    }
    
    .idler-app #message.error {
      background: #fdecea; color: var(--danger); border: 1px solid rgba(198, 40, 40, 0.12);
    }
    
    .idler-app .row-title {
      font-weight: 900; color: var(--primary-dark); margin: 8px 0 6px; font-size: 14px;
    }
    
    .idler-app .type-row, .idler-app .group-row {
      display: flex; gap: 10px;
    }
    
    .idler-app .type-item, .idler-app .group-item {
      flex: 1;
    }
    
    .idler-app .type-label, .idler-app .option-label {
      display: flex; align-items: center; justify-content: center; 
      padding: 10px; border-radius: 10px; border: 2px solid var(--muted);
      background: #f5fbff; color: var(--primary-dark); font-weight: 800; 
      height: 44px; cursor: pointer; font-size: 14px;
    }
    
    .idler-app .option-label {
      border: 2px solid #e1f0ff; height: 44px; background: #f7fbff;
    }
    
    .idler-app input[type="radio"].type-input, 
    .idler-app input.radio-input, 
    .idler-app input.checkbox-input {
      display: none;
    }
    
    .idler-app input[type="radio"].type-input:checked + .type-label,
    .idler-app input.radio-input:checked + .option-label, 
    .idler-app input.checkbox-input:checked + .option-label {
      background: linear-gradient(180deg, var(--accent), var(--primary-dark));
      color: #fff; border-color: var(--primary-dark);
    }
    
    .idler-app .input-number {
      width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e1f0ff;
      font-size: 16px; height: 48px; box-sizing: border-box; background: #fbfeff;
    }
    
    .idler-app .problems {
      display: flex; flex-direction: column; gap: 10px; margin-top: 6px;
    }
    
    .idler-app .problems .line {
      display: flex; gap: 10px;
    }
    
    .idler-app .actions {
      display: flex; flex-direction: column; gap: 10px; margin-top: 12px;
    }
    
    .idler-app .actions .row {
      display: flex; gap: 10px;
    }
    
    .idler-app .btn {
      flex: 1; padding: 12px; border-radius: 10px; border: 0; 
      font-weight: 900; font-size: 15px; cursor: pointer; height: 48px;
    }
    
    .idler-app .btn.save {
      background: var(--success); color: #fff; 
      box-shadow: 0 8px 22px rgba(46, 125, 50, 0.12);
    }
    
    .idler-app .btn.list {
      background: var(--warning); color: #fff; 
      box-shadow: 0 8px 22px rgba(245, 124, 0, 0.12);
    }
    
    .idler-app .btn.exit {
      background: var(--primary-dark); color: #fff; 
      box-shadow: 0 8px 22px rgba(13, 71, 161, 0.12);
    }
    
    /* ===== Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„ ===== */
    .modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5); z-index: 1000;
      justify-content: center; align-items: center;
    }
    
    .modal-content {
      background-color: #fff; padding: 20px; border-radius: 12px;
      width: 90%; max-width: 400px; text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }
    
    .modal-buttons {
      display: flex; justify-content: center; gap: 10px; margin-top: 20px;
    }
    
    .modal-buttons button { flex: 1; padding: 10px; }
    
    /* ===== Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª ===== */
    .progress-display {
      background: #e8f5e9; padding: 8px 12px; border-radius: 8px; 
      margin-bottom: 12px; border: 1px solid #c8e6c9;
    }
    
    .progress-header {
      display: flex; justify-content: space-between; align-items: center; 
      font-weight: 700;
    }
    
    .progress-count {
      font-size: 12px; color: #2e7d32;
    }
    
    .progress-bar {
      background: #c8e6c9; height: 6px; border-radius: 3px; 
      margin-top: 6px; overflow: hidden;
    }
    
    .progress-fill {
      background: #2e7d32; height: 100%; transition: width 0.3s ease;
    }
    
    /* ===== Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ú©Ù…Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ ===== */
    .import-btn {
      background: #9c27b0; color: #fff; border: none;
      padding: 12px; font-weight: 800; border-radius: 10px; cursor: pointer;
      font-size: 15px; margin-top: 8px;
    }
    
    .import-btn:hover {
      background: #7b1fa2;
    }
    
    /* ===== Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ ===== */
    @media (max-width: 420px) {
      .idler-app .card { padding: 12px; max-width: 420px; }
      .idler-app .type-label, .idler-app .option-label { 
        height: 40px; padding: 8px; font-size: 13px; 
      }
      .idler-app .input-number { height: 44px; padding: 10px; font-size: 15px; }
      .idler-app .btn { height: 44px; font-size: 14px; padding: 10px; }
      
      .main-app .card { padding: 10px; }
      .main-app .check-item { padding: 10px; }
      .main-app input, .main-app select, .main-app button, .main-app textarea { 
        padding: 14px; font-size: 17px; 
      }

      .position-labels { gap: 6px; }
      .position-label { padding: 6px; font-size: 13px; }
      .vibration-input { padding: 8px; font-size: 14px; }
      .temp-input { padding: 8px; font-size: 14px; }
      .temp-section { flex-direction: column; gap: 6px; }
      .temp-section label { align-self: flex-start; }
    }
    
    @media (min-height: 700px) {
      .main-app .card { padding: 10px; }
      .main-app .check-item { padding: 10px; }
      .main-app input, .main-app select, .main-app button, .main-app textarea { 
        padding: 14px; font-size: 17px; 
      }
    }
  </style>
</head>
<body>
  <!-- Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ ÙØ±Ù… Ø¨Ø§Ø²Ø±Ø³ÛŒ -->
  <div id="mainApp" class="main-app">
    <!-- ØµÙØ­Ù‡ Ø§ÙˆÙ„ -->
    <div id="page1" class="card">
      <h1>ğŸ“‹ ÙØ±Ù… Ø¨Ø§Ø²Ø±Ø³ÛŒ</h1>
      <label for="personnelId">Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ</label>
      <input id="personnelId" inputmode="numeric" placeholder="Ù…Ø«Ù„Ø§Ù‹ 12001" autocomplete="off">
      <div class="muted">Ù†Ø§Ù… Ø§Ù¾Ø±Ø§ØªÙˆØ±: <strong id="personnelName">---</strong></div>

      <label for="equipmentSelect">Ø§Ù†ØªØ®Ø§Ø¨ ØªØ¬Ù‡ÛŒØ²</label>
      <select id="equipmentSelect"></select>

      <div style="height:10px"></div>
      <button id="startBtn">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²Ø±Ø³ÛŒ</button>
    </div>

    <!-- ØµÙØ­Ù‡ Ø¯ÙˆÙ… -->
    <div id="page2" style="display:none">
      <div class="small-header" id="fixedHeader">
        <div class="pill" id="headerEquipment">-</div>
        <div style="flex:1">
          <div id="headerComponent" style="font-weight:600">-</div>
        </div>
        <div class="toolbar">
          <button id="newFormBtn" class="small-ghost" title="Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ù… Ø¬Ø¯ÛŒØ¯">ÙØ±Ù… Ø¬Ø¯ÛŒØ¯</button>
        </div>
      
        <select id="componentSelectPage2"></select>
      </div>

      <!-- Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª -->
      <div id="progressDisplay" class="progress-display" style="display: none;">
        <div class="progress-header">
          <span>Ù¾ÛŒØ´Ø±ÙØª ÙØ±Ù…: <span id="progressPercentage">0</span>%</span>
          <span class="progress-count"><span id="progressCompleted">0</span> Ø§Ø² <span id="progressTotal">0</span></span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
      </div>

      <div class="card">
        <h2 id="componentTitle" style="margin-top:.5px;font-size:.5px">---</h2>

        <!-- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø¨Ø§ ÙØ¶Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø²Ø±Ú¯â€ŒØªØ± -->
        <div id="checklistContainer"></div>

        <div class="nav">
          <button id="prevBtn" class="small-ghost">â¬… Ø¨Ø±Ú¯Ø´Øª</button>
          <button id="nextBtn">Ø§Ø¯Ø§Ù…Ù‡ â¡</button>
        </div>
      </div>

      <div class="card">
        <div id="gpsWarning" class="gps-warning" style="display: none;">
          âš  Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ GPS Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø®ÙˆØ¯ Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯ Ùˆ Ù…Ø¬ÙˆØ² Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø§ Ø¨Ø¯Ù‡ÛŒØ¯.
        </div>
        <div style="height:8px"></div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button id="saveBtn" style="flex:1">ğŸ“¥ Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ Ùˆ Ø°Ø®ÛŒØ±Ù‡</button>
          <button id="importBtn" class="import-btn" style="flex:1">ğŸ“ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„ÛŒ</button>
          <button id="resetBtn" class="small-ghost" style="flex:1;display:none">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…</button>
        </div>
        <div class="location-status" id="locationStatus">Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...</div>
      </div>
    </div>
  </div>

  <!-- Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø± -->
  <div id="idlerApp" class="idler-app" style="display:none">
    <div class="card" role="application" aria-label="ÙØ±Ù… Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±">
      <div id="message" aria-live="polite"></div>

      <form id="idlerForm" autocomplete="off" novalidate>
        <!-- Ù†ÙˆØ¹ Ø¢ÛŒØ¯Ù„Ø±: Ø±Ø§Ø¯ÛŒÙˆÛŒÛŒ Ùˆ Ø§Ø¬Ø¨Ø§Ø±ÛŒ -->
        <div class="row-title">Ù†ÙˆØ¹ Ø¢ÛŒØ¯Ù„Ø± *</div>
        <div class="type-row" role="radiogroup" aria-required="true">
          <div class="type-item">
            <input class="type-input" type="radio" name="idlerType" id="typeIdler" value="Ø¢ÛŒØ¯Ù„Ø±" required>
            <label class="type-label" for="typeIdler">Ø¢ÛŒØ¯Ù„Ø±</label>
          </div>
          <div class="type-item">
            <input class="type-input" type="radio" name="idlerType" id="typeReturn" value="Ø±ÛŒØªØ±Ù†">
            <label class="type-label" for="typeReturn">Ø±ÛŒØªØ±Ù†</label>
          </div>
          <div class="type-item">
            <input class="type-input" type="radio" name="idlerType" id="typeVertical" value="Ø¢ÛŒØ¯Ù„Ø± ÙˆØ±ØªÛŒÚ©Ø§Ù„">
            <label class="type-label" for="typeVertical">Ø¢ÛŒØ¯Ù„Ø± ÙˆØ±ØªÛŒÚ©Ø§Ù„</label>
          </div>
        </div>

        <!-- Ø´Ù…Ø§Ø±Ù‡ Ø¢ÛŒØ¯Ù„Ø± -->
        <div class="row-title">Ø´Ù…Ø§Ø±Ù‡ Ø¢ÛŒØ¯Ù„Ø± *</div>
        <input id="idlerNumber" class="input-number" type="number" inputmode="numeric" pattern="\d*" placeholder="Ù…Ø«Ø§Ù„: 123" required>

        <!-- Ù…ÙˆÙ‚Ø¹ÛŒØª - Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ -->
        <div class="row-title">Ù…ÙˆÙ‚Ø¹ÛŒØª *</div>
        <div class="group-row" role="radiogroup" aria-required="true" id="positionContainer">
          <!-- Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯ -->
        </div>

        <!-- ÙˆØ¶Ø¹ÛŒØª -->
        <div class="row-title">ÙˆØ¶Ø¹ÛŒØª *</div>
        <div class="group-row" role="radiogroup" aria-required="true">
          <div class="group-item">
            <input class="radio-input" type="radio" name="status" id="statusCritical" value="Ø¨Ø­Ø±Ø§Ù†ÛŒ">
            <label class="option-label" for="statusCritical">Ø¨Ø­Ø±Ø§Ù†ÛŒ</label>
          </div>
          <div class="group-item">
            <input class="radio-input" type="radio" name="status" id="statusNear" value="Ø¯Ø± Ø¢Ø³ØªØ§Ù†Ù‡ Ø®Ø±Ø§Ø¨ÛŒ">
            <label class="option-label" for="statusNear">Ø¯Ø± Ø¢Ø³ØªØ§Ù†Ù‡ Ø®Ø±Ø§Ø¨ÛŒ</label>
          </div>
        </div>

        <!-- Ù…Ø´Ú©Ù„Ø§Øª -->
        <div class="row-title">Ù…Ø´Ú©Ù„Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</div>
        <div class="problems" aria-label="Ù…Ø´Ú©Ù„Ø§Øª">
          <div class="line">
            <div class="group-item">
              <input class="checkbox-input" type="checkbox" id="probTear" value="Ù¾Ø§Ø±Ù‡">
              <label class="option-label" for="probTear">Ù¾Ø§Ø±Ù‡</label>
            </div>
            <div class="group-item">
              <input class="checkbox-input" type="checkbox" id="probBearing" value="Ø¨ÛŒØ±ÛŒÙ†Ú¯ Ø²Ø¯Ù‡">
              <label class="option-label" for="probBearing">Ø¨ÛŒØ±ÛŒÙ†Ú¯ Ø²Ø¯Ù‡</label>
            </div>
            <div class="group-item">
              <input class="checkbox-input" type="checkbox" id="probDisc" value="Ø¯ÛŒØ³Ú©ÛŒ">
              <label class="option-label" for="probDisc">Ø¯ÛŒØ³Ú©ÛŒ</label>
            </div>
          </div>
          <div class="line">
            <div class="group-item">
              <input class="checkbox-input" type="checkbox" id="probCup" value="Ø¬Ø§Ù…">
              <label class="option-label" for="probCup">Ø¬Ø§Ù…</label>
            </div>
            <div class="group-item">
              <input class="checkbox-input" type="checkbox" id="probWear" value="Ø³Ø§ÛŒØ´ Ø²  Ø§Ø¯">
              <label class="option-label" for="probWear">Ø³Ø§ÛŒØ´ Ø²ÛŒØ§Ø¯</label>
            </div>
          </div>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
        <div class="actions" aria-hidden="false">
          <div class="row">
            <button type="button" id="saveContinueBtn" class="btn save">Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø§Ø¯Ø§Ù…Ù‡</button>
          </div>
          <div class="row">
            <button type="button" id="viewListBtn" class="btn list">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„ÛŒØ³Øª</button>
            <button type="button" id="exitIdlerBtn" class="btn exit">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙØ±Ù… Ø§ØµÙ„ÛŒ</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª -->
  <div id="restoreModal" class="modal">
    <div class="modal-content">
      <h3>Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙØ±Ù… Ù†Ø§ØªÙ…Ø§Ù…</h3>
      <p>ÛŒÚ© ÙØ±Ù… Ø¨Ø§Ø²Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ø´Ø¯. Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø² Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ Ú©Ø§Ø± Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ù‡ÛŒØ¯ ÛŒØ§ ÙØ±Ù… Ø¬Ø¯ÛŒØ¯ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯ØŸ</p>
      <div class="modal-buttons">
        <button id="restoreContinueBtn" class="small-ghost">Ø§Ø¯Ø§Ù…Ù‡ ÙØ±Ù… Ù‚Ø¨Ù„ÛŒ</button>
        <button id="restoreNewBtn">Ø´Ø±ÙˆØ¹ ÙØ±Ù… Ø¬Ø¯ÛŒØ¯</button>
      </div>
    </div>
  </div>

  <!-- input Ù…Ø®ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ -->
  <input type="file" id="fileInput" accept=".json" style="display:none">

  <script>
    // ===== Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ =====
    const operators = {
     "12026": "Ø§ÙØ´Ø§Ø± Ø±Ø§Ø¨Ø±ÙŠ Ø­Ø³Ù†", "12077": "Ø®Ù„ÙŠÙÙ‡Ù‘ Ù…ØµØ·ÙÙŠ", "12144": "Ø´ÙŠØ¨Ø§Ù†ÙŠ ØªØ°Ø±Ø¬ÙŠ Ø±Ø¶Ø§", "12227": "Ù…Ø±Ø§Ø¯ÙŠ Ù¾ÙˆØ± Ø´Ù‡Ø±Ø§Ù…", "12536": "Ø¨Ù„ÙˆØ±Ø¯ÙŠ Ø¬ÙˆØ§Ø¯", "12959": "Ø±Ø§Ø¯Ù…Ù‡Ø± Ø±ÙˆØ­ Ø§Ù„Ù„Ù‡", "12963": "Ù†ØµØ±Øª Ø¢Ø¨Ø§Ø¯ÙŠ Ø³Ø¬Ø§Ø¯", "12997": "ØµØ§Ø¯Ù‚ÙŠ Ú¯ÙˆØºØ±ÙŠ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…", "13079": "Ù‚Ø±Ø§ÙŠÙŠ Ø§Ø­Ù…Ø¯", "13104": "Ù†ÙˆØ±ÙˆØ²ÙŠ ÙƒÙˆØ±Ú¯Ø§Ù‡ÙŠ Ø§Ù…ÙŠØ±Ø±Ø¶Ø§", "13202": "Ù†Ú˜Ø§Ø¯Ø­ÙŠØ¯Ø±ÙŠ Ù…Ø­Ù…Ø¯", "13231": "Ø­Ø§ÙØ¸ÙŠ Ù‚Ù‡Ø³ØªØ§Ù†ÙŠ Ø§Ù…ÙŠØ±Ø­Ø³ÙŠÙ†", "14126": "Ø´Ø§Ù‡Ø¨Ø¯Ø§ØºÙŠ Ø§Ø¨ÙˆØ§Ù„Ù‚Ø§Ø³Ù…", "14304": "Ù‚Ù†Ø¨Ø±ÛŒ Ù…Ø³Ø¹ÙˆØ¯", "13348": "Ø§Ø³Ù…Ø§Ø¹ÛŒÙ„ÛŒ Ø¯Ø§Ù†ÛŒØ§Ù„", "12964": "Ù‡Ø§Ø´Ù…ÛŒ Ø±Ø¶Ø§", "12965": "Ø­Ø§ÙØ¸ÛŒ Ù…Ø¬ØªØ¨ÛŒ", "12961": "Ø³ØªÙˆØ¯Ù‡ Ø§Ù…ÛŒØ± Ø­Ø³ÛŒÙ†", "13072": "Ù…Ù‚Ø¯Ù…ÛŒ Ø±Ø§Ù…ÛŒÙ†", "13097": "Ø±Ø­ÛŒÙ…ÛŒ Ø¢Ø±Ù…Ø§Ù†", "13059": "Ù‡Ø§Ø´Ù…ÛŒ Ø³ÛŒØ¯ Ù…Ø­Ø³Ù†", "13209": "Ø§Ù…ÛŒØ±ÛŒ Ø§Ù…ÛŒØ± Ù…Ø­Ù…Ø¯", "13236": "Ú†Ù†Ø§Ø±ÛŒ Ø§Ù…ÛŒØ± Ø­Ø³ÛŒÙ†", "12563": "Ù†ØµØ±Ø§Ù„Ù„Ù‡ Ù¾ÙˆØ± Ù…Ø­Ø³Ù†", "12500": "Ø¹Ù„ÛŒ Ù…Ø±Ø¯Ø§Ù†ÛŒ Ù…Ù‡Ø¯ÛŒ", "12946": "Ø±Ù…Ø¶Ø§Ù†ÛŒ Ø¹Ø¨Ø§Ø³Ø¹Ù„ÛŒ", "12166": "Ø¹Ø¨Ø§Ø³ÛŒ Ø¹Ù„ÛŒØ±Ø¶Ø§", "13321": "Ù¾ÙˆØ±Ø´Ø§Ù‡ Ø¢Ø¨Ø§Ø¯ÛŒ ÙØ±Ù‡Ø§Ø¯", "12691": "Ø±Ù†Ø¬Ø¨Ø± Ù…Ø­Ù…Ø¯", "13374": "ÙÛŒØ±ÙˆØ² Ø¢Ø¨Ø§Ø¯ÛŒ Ù…Ø¹ÛŒÛŒÙ†", "12449": "Ù¾Ø±ÙˆØ±Ø§Ø³ÛŒ Ø§Ú©Ø¨Ø±", "12982": "Ø¬Ù„Ø§Ù„ÛŒ Ø¹Ù„ÛŒØ±Ø¶Ø§", "12929": "Ù…Ø·Ù‡Ø±ÛŒ Ù…ØµØ·ÙÛŒ", "13075": "ÙØ¶Ù„Ø¹Ù„ÛŒ Ø³Ø¹ÛŒØ¯", "13085": "Ù¾ÙˆØ±ÙØ±ÛŒØ¯ÙˆÙ†ÛŒ Ù…Ø­Ù…Ø¯", "13228": "Ø­Ù„ÙˆÛŒÛŒ Ø§Ù…ÛŒØ±Ù…Ø­Ù…Ø¯", "13263": "Ø­ÛŒØ¯Ø±ÛŒ Ø§Ù…ÛŒÙ†", "12631": "Ú©Ø±ÛŒÙ…ÛŒ Ù…Ø­Ù…Ø¯Ø¹Ù„ÛŒ", "12006": "Ù…Ø­Ø¨ÙˆØ¨ÛŒ Ø³Ø¹ÛŒØ¯", "12148": "ØµØ§Ø¯Ù‚ÛŒ Ù…Ø³Ù„Ù…", "12688": "ØºÙ„Ø§Ù…Ø±Ø¶Ø§ Ø¬Ù…Ø§Ø´ÛŒ", "13112": "Ø­Ø³Ù†â€ŒØ²Ø§Ø¯Ù‡ Ù…Ø¬ØªØ¨ÛŒ", "13227": "Ø®ÙˆØ§Ø¬ÙˆÛŒÛŒ Ø§Ù…ÛŒØ±Ù…Ø­Ù…Ø¯", "13347": "ØºÛŒØ§Ø«ÛŒ Ø­Ù…ÛŒØ¯Ø±Ø¶Ø§", "12916": "Ø¹Ø¨Ø§Ø³ÛŒ Ø±Ø¶Ø§", "13013": "Ø§ÙØ´Ø§Ø± Ù…Ù‡Ø¯ÛŒ", "12958": "Ø³Ø§Ù„Ø§Ø±ÛŒ Ø³Ø®Ø§ÙˆØª", "13081": "Ù†Ú˜Ø§Ø¯ØµØ§Ù„Ø­ÛŒ Ø§Ù…ÛŒØ±Ø­Ø³Ù†", "13111": "Ø§Ø³Ù…Ø§Ø¹ÛŒÙ„â€ŒÙ¾ÙˆØ± Ù…Ø­Ù…Ø¯", "13219": "Ù†Ú˜Ø§Ø¯Ú©ÙˆØ±Ú©ÛŒ Ù…Ù‡Ø¯ÛŒ", "14474": "Ú¯Ù„Ø²Ø§Ø±ÛŒ Ø±Ø¶Ø§", "12100": "Ø±Ø¶ÙˆØ§Ù†ÛŒ Ù…Ø³Ø¹ÙˆØ¯", "12078": "Ø®Ù„ÙÛŒÙ‡ Ù¾Ø±ÙˆÛŒØ²", "12188": "Ù‚Ø§Ø³Ù…ÛŒ Ù…Ø­Ø³Ù†", "13346": "Ø´ÙˆÙ„ Ù…ØµØ·ÙÛŒ", "13093": "Ø²ÛŒØ¯Ø¢Ø¨Ø§Ø¯ÛŒ Ù…Ø­Ù…Ø¯", "12951": "Ù¾ÙˆØ±ÙØ±ÛŒØ¯ÙˆÙ†ÛŒ Ø¬ÙˆØ§Ø¯", "13349": "Ø²ÛŒØ¯Ø¢Ø¨Ø§Ø¯ÛŒ Ù…Ø­Ù…Ø¯ ØµØ§Ø¯Ù‚"
    };

    // Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
    const equipmentGroups = {
      group1: ["G7-102", "G7-104/1", "G7-104/2", "G7-105", "G7-106", "G7-107", "G7-211", "G7-212", "G7-215"],
      group2: ["G7-103", "G7-209", "G7-210", "G7-213", "G7-214", "G7-216", "G7-220A", "G7-220B"]
    };
    
    // Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ø± Ú¯Ø±ÙˆÙ‡
    const positionOptions = {
      group1: [
        { value: "Ø´Ø±Ù‚", label: "Ø´Ø±Ù‚" },
        { value: "ÙˆØ³Ø·", label: "ÙˆØ³Ø·" },
        { value: "ØºØ±Ø¨", label: "ØºØ±Ø¨" }
      ],
      group2: [
        { value: "Ø´Ù…Ø§Ù„", label: "Ø´Ù…Ø§Ù„" },
        { value: "ÙˆØ³Ø·", label: "ÙˆØ³Ø·" },
        { value: "Ø¬Ù†ÙˆØ¨", label: "Ø¬Ù†ÙˆØ¨" }
      ]
    };
    
    const equipmentData = {
      "---Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯---": [],
      "G7-102": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:","Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-103": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-104.1": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-104.2": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-105": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-106": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-107": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… ØªØ®Ù„ÛŒÙ‡:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ø¨Ø§Ù„Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
          "G7-209": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª Ùˆ  ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡d:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-210": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-211": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡d:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-212": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-213": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡d:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-214": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-215": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡d:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-216": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-220A": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡d:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡Ø¯:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
      "G7-220B": ["Ø¯Ø±Ø§Ù… ØªÛŒÙ„:", "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:", "Ù†ÙˆØ§Ø±:", "ØºÙ„Ø·Ú© Ù‡Ø§:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:", "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡d:", "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:", "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:", "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:","Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:", "Ø¯Ø±Ø§Ù… Ù‡d:", "Ù…ÙˆØªÙˆØ±:", "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:", "Ú¯ÛŒØ±Ø¨Ú©Ø³:", "5S:", "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±", "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ"],
    };

    const checklistItems = {
      "Ø¯Ø±Ø§Ù… ØªÛŒÙ„:": ["ÙˆØ¶Ø¹ÛŒØª Ø³Ú¯Ù…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ø±Ø§Ù… Ùˆ ØªÙ†Ø´Ù† Ø§Ù„Ø§ÛŒÙ…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´ÙØª", "Ø¯Ù…Ø§ÛŒ Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "Ú©ÙˆØ¨Ø´ Ùˆ ØµØ¯Ø§  Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ„ Ù‡Ø§ Ùˆ Ù†Ø´Øª Ú¯Ø±ÛŒØ³", "ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ÛŒÙ†Ø± Ù‚Ø§Ø¨Ù„Ù…Ù‡ Ø§ÛŒ", "Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³Ù†Ø³ÙˆØ± Ø§Ø³Ù¾ÛŒØ¯"],
      "Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ ØªÛŒÙ„:": ["ÙˆØ¶Ø¹ÛŒØª Ø³Ú¯Ù…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ø±Ø§Ù… Ùˆ ØªÙ†Ø´Ù† Ø§Ù„Ø§ÛŒÙ…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´ÙØª", "Ø¯Ù…Ø§ÛŒ Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "Ú©ÙˆØ¨Ø´ Ùˆ ØµØ¯Ø§  Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ„ Ù‡Ø§ Ùˆ Ù†Ø´Øª Ú¯Ø±ÛŒØ³"],
      "Ø´ÙˆØª ÙˆØ±ÙˆØ¯ÛŒ:": ["ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„Ø§Øª Ø´ÙˆØª", "Ø³ÙˆØ±Ø§Ø® Ø¨ÙˆØ¯Ù†  ÛŒØ§ Ù†Ø´Øª", "ÙˆØ¶Ø¹ÛŒØª Ø±Ø§Ø¨Ø± Ø§Ø³Ú©ÛŒØª Ø¨Ø±Ø¯ Ùˆ Ú©Ù„Ù…Ù¾ Ù‡Ø§", "Ù‡Ù„Ø§ÛŒ Ù¾Ø´Øª Ø´ÙˆØª", "ÙˆØ¶Ø¹ÛŒØª Ø³Ù†Øª Ø±ÛŒØ®ØªÙ† Ø¨Ø§Ø±", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ… Ø¯Ø§ÛŒÙˆØ±ØªØ±"],
      "Ù†ÙˆØ§Ø±:": ["Ø§ØªØµØ§Ù„ (Ø§Ø³Ù¾Ù„Ø§ÛŒØ³-Ø§Ø³Ú©Ø±Ùˆ)", "Ù¾Ø§Ø±Ú¯ÛŒ ØŒØ²Ø¯Ú¯ÛŒ ØŒ ØªØ±Ú©", "Ø§Ù†Ø­Ø±Ø§Ù", "Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³Ù†Ø³ÙˆØ± Ø¯Ø±ÛŒÙØª"],
      "ØºÙ„Ø·Ú© Ù‡Ø§:": ["ÙˆØ¶Ø¹ÛŒØª ØªÙ…Ø§Ø³ Ø¨Ø§ Ø¨Ù„Øª", "Ù¾ÛŒÚ† Ù¾Ø§ÛŒÙ‡ Ø¢ÛŒØ¯Ù„Ø±","ÙˆØ¶Ø¹ÛŒØª Ø³Ù„Ù", "ÙˆØ¶Ø¹ÛŒØª Ù¾Ø§ÛŒÙ‡ Ø³Ø§Ù¾ÙˆØ±Øª Ù‡Ø§ "],
      "Ø¯Ø±Ø§Ù… ØªØ®Ù„ÛŒÙ‡:": ["ÙˆØ¶Ø¹ÛŒØª Ø³Ú¯Ù…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ø±Ø§Ù… Ùˆ ØªÙ†Ø´Ù† Ø§Ù„Ø§ÛŒÙ…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´ÙØª", "Ø¯Ù…Ø§ÛŒ Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "Ú©ÙˆØ¨Ø´ Ùˆ ØµØ¯Ø§  Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ„ Ù‡Ø§ Ùˆ Ù†Ø´Øª Ú¯Ø±ÛŒØ³"],
      "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ø¨Ø§Ù„Ø§:": ["ÙˆØ¶Ø¹ÛŒØª Ø³Ú¯Ù…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ø±Ø§Ù… Ùˆ ØªÙ†Ø´Ù† Ø§Ù„Ø§ÛŒÙ…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´ÙØª", "Ø¯Ù…Ø§ÛŒ Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "Ú©ÙˆØ¨Ø´ Ùˆ ØµØ¯Ø§  Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ„ Ù‡Ø§ Ùˆ Ù†Ø´Øª Ú¯Ø±ÛŒØ³"],
      "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù¾Ø§ÛŒÛŒÙ†:": ["ÙˆØ¶Ø¹ÛŒØª Ø³Ú¯Ù…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ø±Ø§Ù… Ùˆ ØªÙ†Ø´Ù† Ø§Ù„Ø§ÛŒÙ…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´ÙØª", "Ø¯Ù…Ø§ÛŒ Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "Ú©ÙˆØ¨Ø´ Ùˆ ØµØ¯Ø§  Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ„ Ù‡Ø§ Ùˆ Ù†Ø´Øª Ú¯Ø±ÛŒØ³"],
      "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ ØªÛŒÙ„:": ["ÙˆØ¶Ø¹ÛŒØª Ø³Ú¯Ù…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ø±Ø§Ù… Ùˆ ØªÙ†Ø´Ù† Ø§Ù„Ø§ÛŒÙ…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´ÙØª", "Ø¯Ù…Ø§ÛŒ Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "Ú©ÙˆØ¨Ø´ Ùˆ ØµØ¯Ø§  Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ„ Ù‡Ø§ Ùˆ Ù†Ø´Øª Ú¯Ø±ÛŒØ³", "ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ÛŒÙ†Ø± Ù‚Ø§Ø¨Ù„Ù…Ù‡ Ø§ÛŒ", "Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³Ù†Ø³ÙˆØ± Ø§Ø³Ù¾ÛŒØ¯"],
      "Ø¯Ø±Ø§Ù… Ø¨Ù†Ø¯ÛŒÙ†Ú¯ Ù‡Ø¯:": ["ÙˆØ¶Ø¹ÛŒØª Ø³Ú¯Ù…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ø±Ø§Ù… Ùˆ ØªÙ†Ø´Ù† Ø§Ù„Ø§ÛŒÙ…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´ÙØª", "Ø¯Ù…Ø§ÛŒ Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "Ú©ÙˆØ¨Ø´ Ùˆ ØµØ¯Ø§  Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ„ Ù‡Ø§ Ùˆ Ù†Ø´Øª Ú¯Ø±ÛŒØ³", "Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³Ù†Ø³ÙˆØ± Ø§Ø³Ù¾ÛŒØ¯"],
      "Ø¯Ø±Ø§Ù… ØªÙ†Ø´Ù†:": ["ÙˆØ¶Ø¹ÛŒØª Ø³Ú¯Ù…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ø±Ø§Ù… Ùˆ ØªÙ†Ø´Ù† Ø§Ù„Ø§ÛŒÙ…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´ÙØª", "Ø¯Ù…Ø§ÛŒ Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "Ú©ÙˆØ¨Ø´ Ùˆ ØµØ¯Ø§  Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ„ Ù‡Ø§ Ùˆ Ù†Ø´Øª Ú¯Ø±ÛŒØ³", "Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³Ù†Ø³ÙˆØ±  Ø¯Ø±ÛŒÙØª"],
      "Ú©Ø§Ù†ØªØ±ÙˆÛŒØª:": ["ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ… Ø¨Ú©Ø³Ù„ Ù†Ú¯Ù‡Ø¯Ø§Ø±Ù†Ø¯Ù‡", "ÙˆØ¶Ø¹ÛŒØª Ø³ØªÙˆÙ† Ù‡Ø§ÛŒ Ù‡Ø¯Ø§ÛŒØª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ø§Ø®Ú© Ù‡Ø§","ÙˆØ¶Ø¹ÛŒØª Ú¯Ø§ÛŒØ¯ ØªÙÙ„ÙˆÙ†ÛŒ", "ÙˆØ¶Ø¹ÛŒØª Ù‡Ø´ØªÛŒ", "Ù†Ø¸Ø§ÙØª"],
      "Ø´ÙˆØª Ø®Ø±ÙˆØ¬ÛŒ:": ["Ø§ØªØµØ§Ù„Ø§Øª Ø´ÙˆØª", "Ø³ÙˆØ±Ø§Ø® Ø¨ÙˆØ¯Ù†  ÛŒØ§ Ù†Ø´Øª", "ÙˆØ¶Ø¹ÛŒØª Ø±Ø§Ø¨Ø± Ø§Ø³Ú©ÛŒØª Ø¨Ø±Ø¯ Ùˆ Ú©Ù„Ù…Ù¾ Ù‡Ø§", "Ù‡Ù„Ø§ÛŒ Ù¾Ø´Øª Ø´ÙˆØª", "ÙˆØ¶Ø¹ÛŒØª Ø³Ù†Øª Ø±ÛŒØ®ØªÙ† Ø¨Ø§Ø±", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ… Ø¯Ø§ÛŒÙˆØ±ØªØ±", "ÙˆØ¶Ø¹ÛŒØª Ø§Ø³Ú©Ø±Ø§Ù¾Ø±", "Ø³Ø§ÛŒØ´ (Ø¯Ø±Ø§Ù… Ù‡Ø¯ Ø¨Ø§ Ø¨Ø¯Ù†Ù‡ Ø´ÙˆØª)"],
      "Ø¯Ø±Ø§Ù… Ø§Ø³Ù†Ù¾ Ù‡Ø¯:": ["ÙˆØ¶Ø¹ÛŒØª Ø³Ú¯Ù…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ø±Ø§Ù… Ùˆ ØªÙ†Ø´Ù† Ø§Ù„Ø§ÛŒÙ…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´ÙØª", "Ø¯Ù…Ø§ÛŒ Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "Ú©ÙˆØ¨Ø´ Ùˆ ØµØ¯Ø§  Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ„ Ù‡Ø§ Ùˆ Ù†Ø´Øª Ú¯Ø±ÛŒØ³"],
      "Ø¯Ø±Ø§Ù… Ù‡Ø¯:": ["ÙˆØ¶Ø¹ÛŒØª Ø³Ú¯Ù…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ø±Ø§Ù… Ùˆ ØªÙ†Ø´Ù† Ø§Ù„Ø§ÛŒÙ…Ù†Øª", "ÙˆØ¶Ø¹ÛŒØª Ø´ÙØª", "Ø¯Ù…Ø§ÛŒ Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "Ú©ÙˆØ¨Ø´ Ùˆ ØµØ¯Ø§  Ù¾ÛŒÙ„ÙˆØ¨Ù„Ø§Ú©", "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ„ Ù‡Ø§ Ùˆ Ù†Ø´Øª Ú¯Ø±ÛŒØ³"],
      "Ù…ÙˆØªÙˆØ±:": ["Ø¯Ù…Ø§", "Ø§Ø±ØªØ¹Ø§Ø´", "ØµØ¯Ø§", "Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø´Ø§Ø³ÛŒ", "Ù†Ø¸Ø§ÙØª"],
      "Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ù…ÙˆØªÙˆØ±:": ["ØµØ¯Ø§", "Ø¯Ù…Ø§", "Ø±ÙˆØ§Ù†Ú©Ø§Ø±ÛŒ", "ÙˆØ¶Ø¹ÛŒØª Ø­ÙØ§Ø¸"],
      "Ú¯ÛŒØ±Ø¨Ú©Ø³:": ["Ø¯Ù…Ø§", "Ø§Ø±ØªØ¹Ø§Ø´", "ØµØ¯Ø§", "ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„", "Ø³Ø·Ø­ Ùˆ Ù†Ø´Øª Ø±ÙˆØºÙ†", "Ø§ÛŒØ±Ø¨Ø±Ø³Ø±", "Ø´ÛŒØ±ÛŒÙ†Ú¯ Ø¯ÛŒØ³Ú©", "ÙˆØ¶Ø¹ÛŒØª Ú©ÙˆÙ¾Ù„ÛŒÙ†Ú¯ Ø¨Ù‡  Ø¯Ø±Ø§Ù…"],
      "5S:": ["Ù†Ø¸Ø§ÙØª Ù…Ø­ÛŒØ·", "Ø¶  ÛŒØ¹Ø§Øª", "Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø±Ù‚ Ùˆ Ø§Ø¨Ø²Ø§Ø± Ø¯Ù‚ÛŒÙ‚", "Ù…ÙˆØ§Ø±Ø¯ Ø§ÛŒÙ…Ù†ÛŒ"],
      "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±": [], // Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±
      "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ": [] // Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ
    };

    // ===== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø­Ø§Ù„Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ =====
    let currentEquipment = "", currentComponents = [], currentIndex = 0;
    let allComponentsData = [], itemMeta = {};
    let currentLocation = null;
    let geolocationWatchId = null;
    let gpsAccessGranted = false;
    let isFileLoaded = false; // Ø¢ÛŒØ§ ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡ØŸ
    let originalFileData = null; // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ ÙØ§ÛŒÙ„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡
    let editedItemsCount = 0; // ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡

    // ===== Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ =====
    const elId = document.getElementById('personnelId');
    const elName = document.getElementById('personnelName');
    const selEquip = document.getElementById('equipmentSelect');
    const page1 = document.getElementById('page1');
    const page2 = document.getElementById('page2');
    const selCompPage2 = document.getElementById('componentSelectPage2');
    const headerEquipment = document.getElementById('headerEquipment');
    const headerComponent = document.getElementById('headerComponent');
    const componentTitle = document.getElementById('componentTitle');
    const container = document.getElementById('checklistContainer');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const saveBtn = document.getElementById('saveBtn');
    const startBtn = document.getElementById('startBtn');
    const newFormBtn = document.getElementById('newFormBtn');
    const restoreModal = document.getElementById('restoreModal');
    const restoreContinueBtn = document.getElementById('restoreContinueBtn');
    const restoreNewBtn = document.getElementById('restoreNewBtn');
    const locationStatus = document.getElementById('locationStatus');
    const gpsWarning = document.getElementById('gpsWarning');
    const importBtn = document.getElementById('importBtn');
    const fileInput = document.getElementById('fileInput');
    
    // Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª
    const progressDisplay = document.getElementById('progressDisplay');
    const progressPercentage = document.getElementById('progressPercentage');
    const progressCompleted = document.getElementById('progressCompleted');
    const progressTotal = document.getElementById('progressTotal');
    const progressFill = document.getElementById('progressFill');

    // ===== Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢ÛŒØ¯Ù„Ø± =====
    const mainApp = document.getElementById('mainApp');
    const idlerApp = document.getElementById('idlerApp');
    const idlerForm = document.getElementById('idlerForm');
    const idlerNumber = document.getElementById('idlerNumber');
    const saveContinueBtn = document.getElementById('saveContinueBtn');
    const viewListBtn = document.getElementById('viewListBtn');
    const exitIdlerBtn = document.getElementById('exitIdlerBtn');
    const messageEl = document.getElementById('message');
    const positionContainer = document.getElementById('positionContainer');

    // ===== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ =====
    function toEnglishDigits(str) { 
      if (!str) return ""; 
      return String(str)
        .replace(/[Û°-Û¹]/g, d => "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d))
        .replace(/[Ù -Ù©]/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(d))
        .replace(/\s/g, '')
        .replace(/[^0-9]/g, ''); 
    }
    
    function nowFa() { 
      const d = new Date(); 
      return d.toLocaleDateString('fa-IR') + ' ' + d.toLocaleTimeString('fa-IR'); 
    }

    function getCurrentDateOnly() {
      const d = new Date();
      return d.toLocaleDateString('fa-IR').split(' ')[0]; // ÙÙ‚Ø· ØªØ§Ø±ÛŒØ®
    }
    
    function ensureArrayLen(len) { 
      allComponentsData = Array(len).fill(null); 
    }
    
    function escapeHtml(s) { 
      return String(s || '').replace(/[&<>"']/g, m => 
        ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); 
    }

    // ===== ØªÙˆØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª (ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡) =====
    
    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²Ø±Ø³ÛŒ ÛŒÚ© ØªØ¬Ù‡ÛŒØ²
    function calculateTotalItems(equipment) {
        let total = 0;
        const components = equipmentData[equipment] || [];
        
        components.forEach(component => {
            if (component === "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±") {
                // Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ø¢ÛŒØ¯Ù„Ø±ØŒ ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØ¯Ù„Ø±Ù‡Ø§ÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù…Ø§Ø±ÛŒÙ…
                const idlers = JSON.parse(localStorage.getItem('idlers') || '[]');
                const equipmentIdlers = idlers.filter(idler => idler.equipment === equipment);
                total += equipmentIdlers.length;
            } else if (component === "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ") {
                // Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ø§Ø±ØªØ¹Ø§Ø´ØŒ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¢ÛŒØ§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ Ù‡Ø³Øª
                const componentIndex = components.indexOf(component);
                const componentData = allComponentsData[componentIndex];
                
                if (componentData && componentData.vibrationData) {
                    const vibrationData = componentData.vibrationData;
                    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¨Ø§Ú©Ø³ Ù¾Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª
                    let hasData = false;
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØªÙˆØ±
                    if (vibrationData.motor) {
                        const motorFields = ['horizontal1', 'vertical1', 'axial1', 'horizontal2', 'vertical2', 'axial2', 'temperature'];
                        hasData = motorFields.some(field => vibrationData.motor[field] && vibrationData.motor[field].trim() !== '');
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ú¯ÛŒØ±Ø¨Ú©Ø³
                    if (!hasData && vibrationData.gearbox) {
                        const gearboxFields = ['horizontal1', 'vertical1', 'axial1', 'horizontal2', 'vertical2', 'axial2', 'temperature'];
                        hasData = gearboxFields.some(field => vibrationData.gearbox[field] && vibrationData.gearbox[field].trim() !== '');
                    }
                    
                    if (hasData) {
                        total += 14; // 14 Ø¨Ø§Ú©Ø³ Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ
                    }
                    // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù†ÛŒØ³ØªØŒ Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ Ù„Ø§Ø²Ù… Ù†ÛŒØ³Øª Ùˆ Ø´Ù…Ø±Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
                }
            } else {
                // Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ø§Ø¬Ø²Ø§ØŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù…Ø§Ø±ÛŒÙ…
                const items = checklistItems[component] || [];
                total += items.length;
            }
        });
        
        return total;
    }

    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡
    function calculateCompletedItems(equipment, componentsData) {
        let completed = 0;
        const components = equipmentData[equipment] || [];
        
        components.forEach((component, index) => {
            if (component === "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±") {
                // Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ø¢ÛŒØ¯Ù„Ø±ØŒ ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØ¯Ù„Ø±Ù‡Ø§ÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù…Ø§Ø±ÛŒÙ…
                const idlers = JSON.parse(localStorage.getItem('idlers') || '[]');
                const equipmentIdlers = idlers.filter(idler => idler.equipment === equipment);
                completed += equipmentIdlers.length;
            } else if (component === "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ") {
                // Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ø§Ø±ØªØ¹Ø§Ø´ØŒ Ù‡Ø± Ø¨Ø§Ú©Ø³ Ù¾Ø± Ø´Ø¯Ù‡ ÛŒÚ© Ø¢ÛŒØªÙ… ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡ Ø§Ø³Øª
                const componentData = componentsData[index];
                if (componentData && componentData.vibrationData) {
                    const vibrationData = componentData.vibrationData;
                    
                    // Ø´Ù…Ø§Ø±Ø´ Ø¨Ø§Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ù¾Ø± Ø´Ø¯Ù‡ Ù…ÙˆØªÙˆØ±
                    if (vibrationData.motor) {
                        const motorFields = ['horizontal1', 'vertical1', 'axial1', 'horizontal2', 'vertical2', 'axial2', 'temperature'];
                        motorFields.forEach(field => {
                            if (vibrationData.motor[field] && vibrationData.motor[field].trim() !== '') {
                                completed++;
                            }
                        });
                    }
                    
                    // Ø´Ù…Ø§Ø±Ø´ Ø¨Ø§Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ù¾Ø± Ø´Ø¯Ù‡ Ú¯ÛŒØ±Ø¨Ú©Ø³
                    if (vibrationData.gearbox) {
                        const gearboxFields = ['horizontal1', 'vertical1', 'axial1', 'horizontal2', 'vertical2', 'axial2', 'temperature'];
                        gearboxFields.forEach(field => {
                            if (vibrationData.gearbox[field] && vibrationData.gearbox[field].trim() !== '') {
                                completed++;
                            }
                        });
                    }
                }
            } else {
                // Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ø§Ø¬Ø²Ø§ØŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ ÙˆØ¶Ø¹ÛŒØª OK ÛŒØ§ NotOK Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù…Ø§Ø±ÛŒÙ…
                const componentData = componentsData[index];
                if (componentData && componentData.checklist) {
                    componentData.checklist.forEach(item => {
                        if (item.status === 'ok' || item.status === 'notok' || item.status === 'bulk-ok') {
                            completed++;
                        }
                    });
                }
            }
        });
        
        return completed;
    }

    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª
    function updateProgressDisplay() {
        if (!currentEquipment) return;
        
        const totalItems = calculateTotalItems(currentEquipment);
        const completedItems = calculateCompletedItems(currentEquipment, allComponentsData);
        
        let percentage = 0;
        if (totalItems > 0) {
            percentage = Math.round((completedItems / totalItems) * 100);
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§
        progressPercentage.textContent = percentage;
        progressCompleted.textContent = completedItems;
        progressTotal.textContent = totalItems;
        progressFill.style.width = percentage + '%';
        
        // Ù†Ù…Ø§ÛŒØ´ Ø§Ù„Ù…Ø§Ù† Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª
        progressDisplay.style.display = 'block';
    }

    // ===== ØªÙˆØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù„ØºÙˆ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª GPS =====
    
    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± Ù…Ø¬Ø§Ø² Ø¨Ù‡ Ø¹Ø¨ÙˆØ± Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯ÛŒØª GPS Ø§Ø³Øª
    function isUserExemptFromGPS() {
        const pid = toEnglishDigits(elId.value.trim());
        return pid === '14126';
    }

    // Ø§ØµÙ„Ø§Ø­ ØªÙˆØ§Ø¨Ø¹ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ GPS Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù…Ø¹Ø§Ù
    function modifyGPSFunctions() {
        // Ø°Ø®ÛŒØ±Ù‡ ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
        const originalGetLocation = getLocation;
        const originalStartGeolocationMonitoring = startGeolocationMonitoring;
        const originalCheckGeolocationPermission = checkGeolocationPermission;
        
        // Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ ØªÙˆØ§Ø¨Ø¹ Ø¨Ø§ Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ† Ú©Ø§Ø±Ø¨Ø± Ù…Ø¹Ø§Ù
        getLocation = function() {
            if (isUserExemptFromGPS()) {
                // Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù…Ø¹Ø§ÙØŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø³Ø§Ø®ØªÚ¯ÛŒ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                currentLocation = {
                    latitude: 0,
                    longitude: 0,
                    accuracy: 0,
                    timestamp: new Date().toISOString(),
                    exempt: true
                };
                locationStatus.textContent = "Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: Ù…Ø¹Ø§Ù (Ú©Ø§Ø±Ø¨Ø± ÙˆÛŒÚ˜Ù‡)";
                enableFormActions();
                return Promise.resolve(true);
            }
            return originalGetLocation();
        };
        
        startGeolocationMonitoring = function() {
            if (isUserExemptFromGPS()) {
                // Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù…Ø¹Ø§ÙØŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù…ÙˆÙ‚Ø¹ÛŒØª ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª
                locationStatus.textContent = "Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: Ù…Ø¹Ø§Ù (Ú©Ø§Ø±Ø¨Ø± ÙˆÛŒÚ˜Ù‡)";
                enableFormActions();
                return;
            }
            originalStartGeolocationMonitoring();
        };
        
        checkGeolocationPermission = function() {
            if (isUserExemptFromGPS()) {
                return Promise.resolve(true);
            }
            return originalCheckGeolocationPermission();
        };
    }

    // ===== ØªÙˆØ§Ø¨Ø¹ Ø¨Ø®Ø´ Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ (ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡ Ø¨Ø§ 14 Ø¨Ø§Ú©Ø³) =====
    function createVibrationSection() {
      return `
        <div class="vibration-section">
          <!-- Ø¨Ø®Ø´ Ù…ÙˆØªÙˆØ± -->
          <div class="vibration-part">
            <div class="part-title">Ù…ÙˆØªÙˆØ± - Ù†Ù‚Ø·Ù‡ 1</div>
            <div class="position-labels">
              <div class="position-label">Ø§ÙÙ‚ÛŒ</div>
              <div class="position-label">Ø¹Ù…ÙˆØ¯ÛŒ</div>
              <div class="position-label">Ù…Ø­ÙˆØ±ÛŒ</div>
            </div>
            <div class="position-inputs">
              <input type="number" class="vibration-input motor-input" id="motor_horizontal1" placeholder="---" step="0.01" min="0">
              <input type="number" class="vibration-input motor-input" id="motor_vertical1" placeholder="---" step="0.01" min="0">
              <input type="number" class="vibration-input motor-input" id="motor_axial1" placeholder="---" step="0.01" min="0">
            </div>
            
            <div class="part-title" style="margin-top: 15px;">Ù…ÙˆØªÙˆØ± - Ù†Ù‚Ø·Ù‡ 2</div>
            <div class="position-labels">
              <div class="position-label">Ø§ÙÙ‚ÛŒ</div>
              <div class="position-label">Ø¹Ù…ÙˆØ¯ÛŒ</div>
              <div class="position-label">Ù…Ø­ÙˆØ±ÛŒ</div>
            </div>
            <div class="position-inputs">
              <input type="number" class="vibration-input motor-input" id="motor_horizontal2" placeholder="---" step="0.01" min="0">
              <input type="number" class="vibration-input motor-input" id="motor_vertical2" placeholder="---" step="0.01" min="0">
              <input type="number" class="vibration-input motor-input" id="motor_axial2" placeholder="---" step="0.01" min="0">
            </div>
            
            <div class="unit">mm/s</div>
            
            <div class="temp-section">
              <label>ğŸŒ¡ï¸ Ø¯Ù…Ø§ÛŒ Ù…ÙˆØªÙˆØ±:</label>
              <input type="number" class="temp-input motor-input" id="motor_temp" placeholder="---" step="0.1" min="0">
              <span class="unit">Â°C</span>
            </div>
          </div>
          
          <!-- Ø¨Ø®Ø´ Ú¯ÛŒØ±Ø¨Ú©Ø³ -->
          <div class="vibration-part">
            <div class="part-title">Ú¯ÛŒØ±Ø¨Ú©Ø³ - Ù†Ù‚Ø·Ù‡ 1</div>
            <div class="position-labels">
              <div class="position-label">Ø§ÙÙ‚ÛŒ</div>
              <div class="position-label">Ø¹Ù…ÙˆØ¯ÛŒ</div>
              <div class="position-label">Ù…Ø­ÙˆØ±ÛŒ</div>
            </div>
            <div class="position-inputs">
              <input type="number" class="vibration-input gearbox-input" id="gearbox_horizontal1" placeholder="---" step="0.01" min="0">
              <input type="number" class="vibration-input gearbox-input" id="gearbox_vertical1" placeholder="---" step="0.01" min="0">
              <input type="number" class="vibration-input gearbox-input" id="gearbox_axial1" placeholder="---" step="0.01" min="0">
            </div>
            
            <div class="part-title" style="margin-top: 15px;">Ú¯ÛŒØ±Ø¨Ú©Ø³ - Ù†Ù‚Ø·Ù‡ 2</div>
            <div class="position-labels">
              <div class="position-label">Ø§ÙÙ‚ÛŒ</div>
              <div class="position-label">Ø¹Ù…ÙˆØ¯ÛŒ</div>
              <div class="position-label">Ù…Ø­ÙˆØ±ÛŒ</div>
            </div>
            <div class="position-inputs">
              <input type="number" class="vibration-input gearbox-input" id="gearbox_horizontal2" placeholder="---" step="0.01" min="0">
              <input type="number" class="vibration-input gearbox-input" id="gearbox_vertical2" placeholder="---" step="0.01" min="0">
              <input type="number" class="vibration-input gearbox-input" id="gearbox_axial2" placeholder="---" step="0.01" min="0">
            </div>
            
            <div class="unit">mm/s</div>
            
            <div class="temp-section">
              <label>ğŸŒ¡ï¸ Ø¯Ù…Ø§ÛŒ Ú¯ÛŒØ±Ø¨Ú©Ø³:</label>
              <input type="number" class="temp-input gearbox-input" id="gearbox_temp" placeholder="---" step="0.1" min="0">
              <span class="unit">Â°C</span>
            </div>
          </div>
          
          <div style="text-align: center; font-size: 12px; color: #666; margin-top: 10px;">
            ØªÙˆØ¬Ù‡: Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒØŒ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ø®Ø§Ù„ÛŒ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯
          </div>
        </div>
      `;
    }

    function loadVibrationData(componentName) {
      const saved = allComponentsData[currentIndex];
      
      if (saved && saved.vibrationData) {
        const data = saved.vibrationData;
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØªÙˆØ±
        if (data.motor) {
          document.getElementById('motor_horizontal1').value = data.motor.horizontal1 || '';
          document.getElementById('motor_vertical1').value = data.motor.vertical1 || '';
          document.getElementById('motor_axial1').value = data.motor.axial1 || '';
          document.getElementById('motor_horizontal2').value = data.motor.horizontal2 || '';
          document.getElementById('motor_vertical2').value = data.motor.vertical2 || '';
          document.getElementById('motor_axial2').value = data.motor.axial2 || '';
          document.getElementById('motor_temp').value = data.motor.temperature || '';
        }
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯ÛŒØ±Ø¨Ú©Ø³
        if (data.gearbox) {
          document.getElementById('gearbox_horizontal1').value = data.gearbox.horizontal1 || '';
          document.getElementById('gearbox_vertical1').value = data.gearbox.vertical1 || '';
          document.getElementById('gearbox_axial1').value = data.gearbox.axial1 || '';
          document.getElementById('gearbox_horizontal2').value = data.gearbox.horizontal2 || '';
          document.getElementById('gearbox_vertical2').value = data.gearbox.vertical2 || '';
          document.getElementById('gearbox_axial2').value = data.gearbox.axial2 || '';
          document.getElementById('gearbox_temp').value = data.gearbox.temperature || '';
        }
      }
    }

    function saveVibrationData() {
      const vibrationData = {
        motor: {
          horizontal1: document.getElementById('motor_horizontal1').value || '',
          vertical1: document.getElementById('motor_vertical1').value || '',
          axial1: document.getElementById('motor_axial1').value || '',
          horizontal2: document.getElementById('motor_horizontal2').value || '',
          vertical2: document.getElementById('motor_vertical2').value || '',
          axial2: document.getElementById('motor_axial2').value || '',
          temperature: document.getElementById('motor_temp').value || ''
        },
        gearbox: {
          horizontal1: document.getElementById('gearbox_horizontal1').value || '',
          vertical1: document.getElementById('gearbox_vertical1').value || '',
          axial1: document.getElementById('gearbox_axial1').value || '',
          horizontal2: document.getElementById('gearbox_horizontal2').value || '',
          vertical2: document.getElementById('gearbox_vertical2').value || '',
          axial2: document.getElementById('gearbox_axial2').value || '',
          temperature: document.getElementById('gearbox_temp').value || ''
        },
        unit: "mm/s",
        timestamp: new Date().toISOString()
      };
      
      return vibrationData;
    }

    // ===== ØªÙˆØ§Ø¨Ø¹ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢ÛŒØ¯Ù„Ø± =====
    function showMessage(text, type = 'success') {
      messageEl.textContent = text;
      messageEl.className = '';
      messageEl.classList.add(type === 'error' ? 'error' : 'success');
      messageEl.style.display = 'block';
      setTimeout(() => messageEl.style.display = 'none', 2200);
    }

    function validateIdlerForm(requireType = true) {
      const num = idlerNumber.value.trim();
      const pos = document.querySelector('input[name="position"]:checked');
      const st = document.querySelector('input[name="status"]:checked');
      const type = document.querySelector('input[name="idlerType"]:checked');
      
      if (requireType && !type) { 
        showMessage('Ù„Ø·ÙØ§Ù‹ Ù†ÙˆØ¹ Ø¢ÛŒØ¯Ù„Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error'); 
        return false; 
      }
      if (!num) { 
        showMessage('Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ø¢ÛŒØ¯Ù„Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error'); 
        idlerNumber.focus(); 
        return false; 
      }
      if (!pos) { 
        showMessage('Ù„Ø·ÙØ§Ù‹ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error'); 
        return false; 
      }
      if (!st) { 
        showMessage('Ù„Ø·ÙØ§Ù‹ ÙˆØ¶Ø¹ÛŒØª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error'); 
        return false; 
      }
      return true;
    }

    function collectProblems() {
      const ids = ['probTear', 'probBearing', 'probDisc', 'probCup', 'probWear'];
      return ids.filter(id => document.getElementById(id).checked)
               .map(id => document.getElementById(id).value);
    }
    
    function collectType() {
      const el = document.querySelector('input[name="idlerType"]:checked');
      return el ? el.value : '';
    }

    function saveIdler() {
      const idlers = JSON.parse(localStorage.getItem('idlers') || '[]');
      idlers.push({
        number: idlerNumber.value.trim(),
        type: collectType(),
        position: document.querySelector('input[name="position"]:checked').value,
        status: document.querySelector('input[name="status"]:checked').value,
        problems: collectProblems(),
        timestamp: new Date().toISOString(),
        equipment: currentEquipment // Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù… ØªØ¬Ù‡ÛŒØ²
      });
      localStorage.setItem('idlers', JSON.stringify(idlers));
      
      // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª Ù¾Ø³ Ø§Ø² Ø°Ø®ÛŒØ±Ù‡ Ø¢ÛŒØ¯Ù„Ø±
      updateProgressDisplay();
    }

    function resetIdlerFormKeepTypeFocus() {
      // Ø­ÙØ¸ Ù†ÙˆØ¹ Ø¢ÛŒØ¯Ù„Ø±
      const selectedType = document.querySelector('input[name="idlerType"]:checked');
      const keepValue = selectedType ? selectedType.value : null;
      
      // Ø±ÛŒØ³Øª Ú©Ù„ ÙØ±Ù…
      idlerForm.reset();
      
      // Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ù†ÙˆØ¹ Ø¢ÛŒØ¯Ù„Ø±
      if (keepValue) {
        const el = Array.from(document.querySelectorAll('input[name="idlerType"]'))
                        .find(r => r.value === keepValue);
        if (el) el.checked = true;
      }
      
      // ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¬Ù‡ÛŒØ² ÙØ¹Ù„ÛŒ
      setupPositionOptions();
      
      // ÙÙˆÚ©ÙˆØ³ Ø±ÙˆÛŒ ØªÚ©Ø³â€ŒØ¨Ø§Ú©Ø³ Ø´Ù…Ø§Ø±Ù‡
      idlerNumber.focus();
    }

    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¬Ù‡ÛŒØ² Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
    function setupPositionOptions() {
      // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
      positionContainer.innerHTML = '';
      
      // ØªØ´Ø®ÛŒØµ Ú¯Ø±ÙˆÙ‡ ØªØ¬Ù‡ÛŒØ²
      let positions = [];
      if (equipmentGroups.group1.includes(currentEquipment)) {
        positions = positionOptions.group1;
      } else if (equipmentGroups.group2.includes(currentEquipment)) {
        positions = positionOptions.group2;
      } else {
        // Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
        positions = positionOptions.group1;
      }
      
      // Ø§ÛŒØ¬Ø§Ø¯ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
      positions.forEach((pos, index) => {
        const groupItem = document.createElement('div');
        groupItem.className = 'group-item';
        
        const inputId = `pos${index}`;
        
        groupItem.innerHTML = `
          <input class="radio-input" type="radio" name="position" id="${inputId}" value="${pos.value}">
          <label class="option-label" for="${inputId}">${pos.label}</label>
        `;
        
        positionContainer.appendChild(groupItem);
      });
    }

    function buildIdlerListHtml(items) {
      const rows = (items && items.length)
        ? items.map((it, idx) => `
            <tr>
              <td>${escapeHtml(it.number)}</td>
              <td>${escapeHtml(it.type || '-')}</td>
              <td>${escapeHtml(it.position)}</td>
              <td>${escapeHtml(it.status)}</td>
              <td>${escapeHtml(it.equipment || '-')}</td>
              <td>${escapeHtml(Array.isArray(it.problems) && it.problems.length ? it.problems.join(', ') : '-')}</td>
              <td><button class="del" data-idx="${idx}">Ø­Ø°Ù</button></td>
            </tr>
          `).join('')
        : `<tr><td colspan="7" style="padding:18px;text-align:center;color:#666">Ù‡ÛŒÚ† Ø¢ÛŒØ¯Ù„Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>`;

      return `<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Ù„ÛŒØ³Øª Ø¢ÛŒØ¯Ù„Ø±Ù‡Ø§</title>
<style>
  :root{--primary:#0d47a1;--danger:#c62828;--success:#2e7d32;}
  html,body{height:100%;margin:0;padding:0;font-family:Tahoma,Arial,sans-serif;background:#f6fbff;}
  body{min-height:100vh;overflow:auto;padding:0;margin:0;}
  .wrap{min-height:100vh;box-sizing:border-box;padding:12px;width:100%;}
  h1{text-align:center;color:var(--primary);margin:8px 0 12px;font-size:18px;}
  .table-wrap{background:#fff;border-radius:12px;padding:8px;box-shadow:0 10px 30px rgba(13,47,91,0.06);overflow:auto;max-height:calc(100vh - 120px);}
  table{width:100%;border-collapse:collapse;font-size:15px;min-width:600px;}
  thead th{position:sticky;top:0;background:var(--primary);color:#fff;padding:12px;font-weight:800;text-align:center;}
  tbody td{padding:12px;text-align:center;border-bottom:1px solid #eef6ff;}
  .del{background:var(--danger);color:#fff;border:0;padding:8px 10px;border-radius:8px;font-weight:800;cursor:pointer}
  .controls{display:flex;gap:10px;justify-content:center;margin-top:12px;}
  .btn{padding:12px 14px;border-radius:10px;border:0;font-weight:800;cursor:pointer}
  .btn.download{background:var(--success);color:#fff}
  .btn.close{background:var(--primary);color:#fff}
  
  @media (max-width: 768px) {
    body{padding:5px;}
    .wrap{padding:5px;}
    h1{font-size:16px;margin:4px 0 8px;}
    .table-wrap{padding:4px;max-height:calc(100vh - 100px);}
    table{font-size:13px;min-width:700px;}
    thead th, tbody td{padding:8px 4px;}
    .btn{padding:10px 12px;font-size:14px;}
    .del{padding:6px 8px;font-size:12px;}
  }
  
  @media (max-width: 480px) {
    table{font-size:12px;}
    thead th, tbody td{padding:6px 3px;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Ù„ÛŒØ³Øª Ø¢ÛŒØ¯Ù„Ø±Ù‡Ø§ÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡</h1>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Ø´Ù…Ø§Ø±Ù‡</th><th>Ù†ÙˆØ¹</th><th>Ù…ÙˆÙ‚Ø¹ÛŒØª</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>ØªØ¬Ù‡ÛŒØ²</th><th>Ù…Ø´Ú©Ù„Ø§Øª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead>
        <tbody id="tbody">${rows}</tbody>
      </table>
    </div>
    <div class="controls">
      <button class="btn close" id="closeWin">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

<script>
  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
  function render(){
    const items = JSON.parse(localStorage.getItem('idlers') || '[]');
    const tbody = document.getElementById('tbody');
    if(!items || items.length===0){
      tbody.innerHTML = '<tr><td colspan="7" style="padding:18px;text-align:center;color:#666">Ù‡ÛŒÚ† Ø¢ÛŒØ¯Ù„Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
      return;
    }
    tbody.innerHTML = items.map((it,idx)=>'<tr>'
      + '<td>'+escapeHtml(it.number)+'</td>'
      + '<td>'+escapeHtml(it.type||'-')+'</td>'
      + '<td>'+escapeHtml(it.position)+'</td>'
      + '<td>'+escapeHtml(it.status)+'</td>'
      + '<td>'+escapeHtml(it.equipment||'-')+'</td>'
      + '<td>'+escapeHtml(Array.isArray(it.problems)&&it.problems.length?it.problems.join(', '):'-')+'</td>'
      + '<td><button class="del" data-idx="'+idx+'">Ø­Ø°Ù</button></td>'
      + '</tr>').join('');
    attachDel();
  }
  function attachDel(){
    document.querySelectorAll('.del').forEach(btn=>{
      btn.addEventListener('click', function(){
        const idx = parseInt(this.getAttribute('data-idx'),10);
        let items = JSON.parse(localStorage.getItem('idlers') || '[]');
        if(idx>=0 && idx<items.length){
          items.splice(idx,1);
          localStorage.setItem('idlers', JSON.stringify(items));
          render();
        }
      });
    });
  }
  document.getElementById('closeWin').addEventListener('click', function(){ window.close(); });
  
  window.addEventListener('load', function() {
    window.resizeTo(screen.width, screen.height);
    window.moveTo(0, 0);
    document.body.style.width = '100%';
    document.body.style.height = '100%';
  });
  
  render();
<\/script>
</body>
</html>`;
    }

    // ===== Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù…Ø§ÛŒØ´ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ =====
    function showMainApp() {
      mainApp.style.display = 'block';
      idlerApp.style.display = 'none';
      // ÙˆÙ‚ØªÛŒ Ø¨Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²Ú¯Ø´ØªÛŒÙ…ØŒ Ø¬Ø²Ø¡ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      if (currentComponents.length > 0) {
        loadComponent(currentIndex);
      }
    }

    function showIdlerApp() {
      mainApp.style.display = 'none';
      idlerApp.style.display = 'flex';
      // ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¬Ù‡ÛŒØ² ÙØ¹Ù„ÛŒ
      setupPositionOptions();
      // ÙÙˆÚ©ÙˆØ³ Ø±ÙˆÛŒ ØªÚ©Ø³â€ŒØ¨Ø§Ú©Ø³ Ø´Ù…Ø§Ø±Ù‡
      setTimeout(() => idlerNumber.focus(), 150);
    }

    // ===== Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢ÛŒØ¯Ù„Ø± =====
    saveContinueBtn.addEventListener('click', function() {
      if (!validateIdlerForm(true)) return;
      saveIdler();
      resetIdlerFormKeepTypeFocus();
      showMessage('Ø¢ÛŒØ¯Ù„Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯. ÙØ±Ù… Ø¢Ù…Ø§Ø¯Ù‡ Ø«Ø¨Øª Ø¨Ø¹Ø¯ÛŒ Ø§Ø³Øª.', 'success');
    });

    viewListBtn.addEventListener('click', function() {
      const items = JSON.parse(localStorage.getItem('idlers') || '[]');
      const html = buildIdlerListHtml(items);
      const win = window.open('', '_blank', 'width=' + screen.width + ', height=' + screen.height);
      if (!win) { 
        showMessage('Ø¨Ø§Ø² Ø´Ø¯Ù† ØµÙØ­Ù‡ Ù„ÛŒØ³Øª Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯. Ù¾Ø§Ù¾â€ŒØ¢Ù¾ Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.', 'error'); 
        return; 
      }
      win.document.open();
      win.document.write(html);
      win.document.close();
      win.focus();
    });

    exitIdlerBtn.addEventListener('click', function() {
      const typeSelected = document.querySelector('input[name="idlerType"]:checked');
      if (!typeSelected) { 
        showMessage('Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ø§Ø¨ØªØ¯Ø§ Ù†ÙˆØ¹ Ø¢ÛŒØ¯Ù„Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯.', 'error'); 
        return; 
      }

      const pos = document.querySelector('input[name="position"]:checked');
      const st = document.querySelector('input[name="status"]:checked');
      if (idlerNumber.value.trim() && pos && st) {
        saveIdler();
      }

      showMainApp();
    });

    // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù… Ø¨Ø§ Enter
    idlerForm.addEventListener('submit', function(e) { e.preventDefault(); });

    // ===== ØªÙˆØ§Ø¨Ø¹ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ =====
    function checkGeolocationPermission() {
      return new Promise((resolve) => {
        if (!navigator.geolocation) {
          resolve(false);
          return;
        }
        
        navigator.permissions.query({ name: 'geolocation' })
          .then((result) => {
            if (result.state === 'granted') {
              resolve(true);
            } else if (result.state === 'prompt') {
              navigator.geolocation.getCurrentPosition(
                () => resolve(true),
                () => resolve(false),
                { timeout: 5000 }
              );
            } else {
              resolve(false);
            }
          })
          .catch(() => resolve(false));
      });
    }

    function disableFormActions() {
      const activeButtons = [nextBtn, prevBtn, saveBtn, newFormBtn];
      activeButtons.forEach(btn => {
        if (btn) {
          btn.disabled = true;
          btn.style.opacity = '0.6';
          btn.style.cursor = 'not-allowed';
        }
      });
      gpsWarning.style.display = 'block';
      locationStatus.classList.remove('active');
      locationStatus.classList.add('inactive');
      gpsAccessGranted = false;
    }

    function enableFormActions() {
      const activeButtons = [nextBtn, prevBtn, saveBtn, newFormBtn];
      activeButtons.forEach(btn => {
        if (btn) {
          btn.disabled = false;
          btn.style.opacity = '1';
          btn.style.cursor = 'pointer';
        }
      });
      gpsWarning.style.display = 'none';
      locationStatus.classList.remove('inactive');
      locationStatus.classList.add('active');
      gpsAccessGranted = true;
    }

    function startGeolocationMonitoring() {
      if (geolocationWatchId) {
        navigator.geolocation.clearWatch(geolocationWatchId);
      }
      
      geolocationWatchId = navigator.geolocation.watchPosition(
        function(position) {
          currentLocation = {
            latitude: position.coords.latitude,
            longitude: position.coords.longitude,
            accuracy: position.coords.accuracy,
            timestamp: new Date().toISOString()
          };
          locationStatus.textContent = `Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: ÙØ¹Ø§Ù„ (Ø¯Ù‚Øª: ${Math.round(currentLocation.accuracy)} Ù…ØªØ±)`;
          enableFormActions();
        },
        function(error) {
          let errorMessage = "Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: ØºÛŒØ±ÙØ¹Ø§Ù„ - ";
          switch(error.code) {
            case error.PERMISSION_DENIED:
              errorMessage += "Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø¯ Ø´Ø¯. Ù„Ø·ÙØ§ GPS Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯ Ùˆ Ù…Ø¬ÙˆØ² Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø±Ø§ Ø¨Ø¯Ù‡ÛŒØ¯.";
              break;
            case error.POSITION_UNAVAILABLE:
              errorMessage += "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. GPS Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.";
              break;
            case error.TIMEOUT:
              errorMessage += "Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯.";
              break;
            default:
              errorMessage += "Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡";
              break;
          }
          locationStatus.textContent = errorMessage;
          disableFormActions();
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 30000
        }
      );
    }

    function getLocation() {
      return new Promise((resolve) => {
        locationStatus.textContent = "Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...";
        
        if (!navigator.geolocation) {
          locationStatus.textContent = "Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯";
          disableFormActions();
          resolve(false);
          return;
        }

        navigator.geolocation.getCurrentPosition(
          function(position) {
            currentLocation = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
              accuracy: position.coords.accuracy,
              timestamp: new Date().toISOString()
            };
            locationStatus.textContent = `Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: Ù…ÙˆÙÙ‚ (Ø¯Ù‚Øª: ${Math.round(currentLocation.accuracy)} Ù…ØªØ±)`;
            enableFormActions();
            resolve(true);
          },
          function(error) {
            let errorMessage = "Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: Ù†Ø§Ù…ÙˆÙÙ‚ - ";
            switch(error.code) {
              case error.PERMISSION_DENIED:
                errorMessage += "  Ø³ØªØ±Ø³ÛŒ Ø±Ø¯ Ø´Ø¯. Ù„Ø·ÙØ§ GPS Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.";
                break;
              case error.POSITION_UNAVAILABLE:
                errorMessage += "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª.";
                break;
              case error.TIMEOUT:
                errorMessage += "Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯.";
                break;
              default:
                errorMessage += "Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡";
                break;
            }
            locationStatus.textContent = errorMessage;
            disableFormActions();
            resolve(false);
          },
          {
            enableHighAccuracy: true,
            timeout: 15000,
            maximumAge: 0
          }
        );
      });
    }

    // ===== Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§Ø² localStorage =====
    function saveStateToLocalStorage() {
      const state = {
        personnelId: elId.value,
        equipment: currentEquipment,
        currentIndex: currentIndex,
        allComponentsData: allComponentsData,
        itemMeta: itemMeta,
        timestamp: new Date().getTime()
      };
      localStorage.setItem('inspectorFormState', JSON.stringify(state));
    }

    function loadStateFromLocalStorage() {
      const stateStr = localStorage.getItem('inspectorFormState');
      if (stateStr) {
        return JSON.parse(stateStr);
      }
      return null;
    }

    function clearStateFromLocalStorage() {
      localStorage.removeItem('inspectorFormState');
    }

    function checkForSavedState() {
      const savedState = loadStateFromLocalStorage();
      if (savedState && savedState.personnelId && savedState.equipment) {
        const now = new Date().getTime();
        const timeDiff = now - savedState.timestamp;
        const hoursDiff = timeDiff / (1000 * 60 * 60);
        
        if (hoursDiff < 24) {
          return savedState;
        } else {
          clearStateFromLocalStorage();
        }
      }
      return null;
    }

    // ===== ØªÙˆØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú†Ú©â€ŒØ¨Ø§Ú©Ø³ "Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ OK" =====
    function createSelectAllCheckbox() {
      return `
        <div class="select-all-container">
          <label class="select-all-checkbox">
            <input type="checkbox" id="selectAllOkCheckbox">
            <span>âœ… Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† OK</span>
          </label>
          <div class="select-all-hint">
            Ø§Ø¨ØªØ¯Ø§ Ù…ÙˆØ§Ø±Ø¯ Ù…Ø´Ú©Ù„â€ŒØ¯Ø§Ø± Ø±Ø§ Ø¹Ù„Ø§Ù…Øªâ€ŒØ¨Ø²Ù†ÛŒØ¯ØŒ Ø³Ù¾Ø³ Ø§ÛŒÙ† Ú¯Ø²ÛŒÙ†Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
          </div>
        </div>
      `;
    }

    // ===== ØªÙˆØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ JSON =====
    function setupImportFileFunctionality() {
      importBtn.addEventListener('click', () => {
        fileInput.click();
      });

      fileInput.addEventListener('change', handleFileSelect);
    }

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const fileData = JSON.parse(e.target.result);
          validateAndLoadFile(fileData);
        } catch (error) {
          alert('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ JSON. Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
          console.error('Error parsing JSON:', error);
        }
      };
      reader.readAsText(file);
    }

    function validateAndLoadFile(fileData) {
      // Ù‚Ø§Ù†ÙˆÙ† Û±: Ø¨Ø±Ø±Ø³ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ
      const currentPid = toEnglishDigits(elId.value.trim());
      const filePid = toEnglishDigits(fileData.personnelId);
      
      if (currentPid !== filePid) {
        alert(`Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ ÙØ§ÛŒÙ„ (${fileData.personnelId}) Ø¨Ø§ Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ (${elId.value}) Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ø¯.`);
        return;
      }

      // Ù‚Ø§Ù†ÙˆÙ† Û²: Ø¨Ø±Ø±Ø³ÛŒ ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª Ø§ÙˆÙ„ÛŒÙ‡
      const today = getCurrentDateOnly();
      const fileDate = fileData.originalDate || fileData.savedAt?.split(' ')[0];
      
      if (fileDate !== today) {
        alert(`ÙØ§ÛŒÙ„ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ØªØ§Ø±ÛŒØ® ${fileDate} Ø§Ø³Øª (Ø§Ù…Ø±ÙˆØ²: ${today}). ÙÙ‚Ø· ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ù‚Ø§Ø¨Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù‡Ø³ØªÙ†Ø¯.`);
        return;
      }

      // Ù‚Ø§Ù†ÙˆÙ† Û³: Ø¨Ø±Ø±Ø³ÛŒ ØªØ¬Ù‡ÛŒØ²
      if (fileData.equipment !== currentEquipment && currentEquipment !== "") {
        const confirmLoad = confirm(
          `ØªØ¬Ù‡ÛŒØ² ÙØ§ÛŒÙ„ (${fileData.equipment}) Ø¨Ø§ ØªØ¬Ù‡ÛŒØ² ÙØ¹Ù„ÛŒ (${currentEquipment}) Ù…ØªÙØ§ÙˆØª Ø§Ø³Øª.\nØ¢ÛŒØ§ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ`
        );
        if (!confirmLoad) return;
      }

      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
      loadFileData(fileData);
    }

    function loadFileData(fileData) {
      // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒØ§Ø¨ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´
      originalFileData = JSON.parse(JSON.stringify(fileData));
      isFileLoaded = true;
      editedItemsCount = 0;

      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±Ø³Ù†Ù„ÛŒ (ÙÙ‚Ø· Ù†Ù…Ø§ÛŒØ´ÛŒ)
      elId.value = fileData.personnelId;
      elName.textContent = fileData.personnelName || operators[toEnglishDigits(fileData.personnelId)] || '---';

      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ¬Ù‡ÛŒØ²
      if (fileData.equipment && !currentEquipment) {
        currentEquipment = fileData.equipment;
        selEquip.value = currentEquipment;
        currentComponents = equipmentData[currentEquipment] || [];
        
        if (!currentComponents.length) {
          alert('Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ¬Ù‡ÛŒØ² Ø¬Ø²Ø¡ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª');
          return;
        }

        ensureArrayLen(currentComponents.length);
        itemMeta = {};
        fillComponentsDropdownPage2();
        
        // Ø´Ø±ÙˆØ¹ Ù†Ø¸Ø§Ø±Øª Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ
        startGeolocationMonitoring();
        
        // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ø¯ÙˆÙ…
        page1.style.display = 'none';
        page2.style.display = 'block';
      }

      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬Ø²Ø§
      if (fileData.components && Array.isArray(fileData.components)) {
        fileData.components.forEach((componentData, index) => {
          if (index < allComponentsData.length) {
            allComponentsData[index] = componentData;
            
            // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† "ØºÛŒØ± ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡"
            if (componentData.checklist) {
              componentData.checklist.forEach(item => {
                item.wasEdited = false;
                item.originalTimestamp = item.timestamp;
              });
            }
          }
        });
      }

      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢ÛŒØ¯Ù„Ø±Ù‡Ø§
      if (fileData.idlers && Array.isArray(fileData.idlers)) {
        localStorage.setItem('idlers', JSON.stringify(fileData.idlers));
      }

      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¬Ø²Ø¡ ÙØ¹Ù„ÛŒ
      loadComponent(0);

      alert('ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯. Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙˆÛŒØ±Ø§ÛŒØ´â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø±Ø§ Ø§Ø¹Ù…Ø§Ù„ Ú©Ù†ÛŒØ¯.');
    }

    // ===== ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ (ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯) =====
    (function fillEquip() {
      selEquip.innerHTML = '';
      Object.keys(equipmentData).forEach(k => {
        const o = document.createElement('option'); 
        o.value = k; 
        o.textContent = k; 
        selEquip.appendChild(o);
      });
    })();

    elId.addEventListener('input', () => { 
      const id = toEnglishDigits(elId.value); 
      elName.textContent = operators[id] || '---'; 
      if (currentEquipment) {
        saveStateToLocalStorage();
      }
    });

    startBtn.addEventListener('click', async () => {
      const pid = toEnglishDigits(elId.value.trim());
      const pname = elName.textContent || '---';
     
      elName.textContent = operators[pid] || elName.textContent || '---';
      if (!pid || pname === '---') { 
        alert('Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); 
        return false; 
      }
      
      const hasPermission = await checkGeolocationPermission();
      if (!hasPermission) {
        alert('Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ØŒ Ø¨Ø§ÛŒØ¯ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ (GPS) Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.');
        const locationSuccess = await getLocation();
        if (!locationSuccess) {
          return false;
        }
      }
      
      currentEquipment = selEquip.value;
      currentComponents = equipmentData[currentEquipment] || [];
      if (!currentComponents.length) { 
        alert('Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ¬Ù‡ÛŒØ² Ø¬Ø²Ø¡ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª'); 
        return; 
      }

      ensureArrayLen(currentComponents.length);
      itemMeta = {};
      fillComponentsDropdownPage2();
      loadComponent(0);
      page1.style.display = 'none';
      page2.style.display = 'block';
      
      startGeolocationMonitoring();
      saveStateToLocalStorage();
      
      setTimeout(() => { 
        window.scrollTo({ top: 0, behavior: 'smooth' }); 
        document.documentElement.scrollTop = 0; 
        document.body.scrollTop = 0; 
      }, 60);
    });

    function fillComponentsDropdownPage2() {
      selCompPage2.innerHTML = '';
      currentComponents.forEach((c, i) => { 
        const opt = document.createElement('option'); 
        opt.value = String(i); 
        opt.textContent = c; 
        selCompPage2.appendChild(opt); 
      });
      selCompPage2.onchange = () => { 
        saveCurrentComponentData(); 
        const selectedIndex = parseInt(selCompPage2.value, 10);
        
        // Ø§Ú¯Ø± "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±" Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ØŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢ÛŒØ¯Ù„Ø± Ø¨Ø±Ùˆ
        if (currentComponents[selectedIndex] === "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±") {
          showIdlerApp();
        } else {
          loadComponent(selectedIndex);
        }
      };
    }

    




function loadComponent(index) {
  if (index < 0 || index >= currentComponents.length) return;
  
  const compName = currentComponents[index];
  
  // Ø§Ú¯Ø± Ø¬Ø²Ø¡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±" Ø¨Ø§Ø´Ø¯
  if (compName === "Ø«Ø¨Øª Ø¢ÛŒØ¯Ù„Ø±") {
    showIdlerApp();
    return;
  }
  
  currentIndex = index;
  headerEquipment.textContent = currentEquipment;
  headerComponent.textContent = currentComponents[index];
  selCompPage2.value = String(index);
  componentTitle.textContent = `${currentEquipment} â€” ${currentComponents[index]}`;
  container.innerHTML = '';
  
  if (!itemMeta[compName]) itemMeta[compName] = {};
  
  // Ø§Ú¯Ø± Ø¬Ø²Ø¡ "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ" Ø¨Ø§Ø´Ø¯
  if (compName === "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ") {
    container.innerHTML = createVibrationSection();
    loadVibrationData(compName);
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listeners Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ùˆ Ø±Ø¯ÛŒØ§Ø¨ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´
    const inputs = container.querySelectorAll('.motor-input, .gearbox-input');
    inputs.forEach(input => {
      input.addEventListener('input', () => {
        // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡
        const componentData = allComponentsData[currentIndex];
        if (componentData) {
          componentData.wasEdited = true;
        }
        
        saveCurrentComponentData();
        saveStateToLocalStorage();
        updateProgressDisplay();
      });
    });
    
  } else {
    // Ú©Ø¯ Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ø§Ø¬Ø²Ø§ - Ø§Ø¨ØªØ¯Ø§ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ØŒ Ø³Ù¾Ø³ Ú†Ú©â€ŒØ¨Ø§Ú©Ø³
    const items = checklistItems[compName] || [];
    const saved = allComponentsData[index];

    // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§
    const itemsContainer = document.createElement('div');
    itemsContainer.id = 'itemsContainer';
    
    // Ø§ÛŒØ¬Ø§Ø¯ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§
    items.forEach((it, i) => {
      const wrap = document.createElement('div'); 
      wrap.className = 'check-item'; 
      wrap.dataset.idx = String(i);
      
      wrap.innerHTML = `
        <div style="font-size:17px;font-weight:800">${it}</div>
        <div class="ci-opts">
          <label for="ok_${index}_${i}" class="ok-opt">âœ… Ok</label>
          <label for="notok_${index}_${i}" class="notok-opt">âŒ NotOk</label>
        </div>
        <input class="note" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)">
      `;
      itemsContainer.appendChild(wrap);

      const okLabel = wrap.querySelector('.ok-opt');
      const notOkLabel = wrap.querySelector('.notok-opt');
      const note = wrap.querySelector('.note');

      let currentStatus = '';
      let isBulkOk = false;
      
      if (saved && saved.checklist && saved.checklist[i]) {
        const s = saved.checklist[i];
        currentStatus = s.status || '';
        if (s.note) note.value = s.note;
        
        if (currentStatus === 'ok') {
          okLabel.classList.add('selected');
        } else if (currentStatus === 'notok') {
          notOkLabel.classList.add('selected');
        } else if (currentStatus === 'bulk-ok') {
          okLabel.classList.add('selected');
          okLabel.classList.add('bulk-ok');
          isBulkOk = true;
        }
      }

      function toggleSelection(selectedValue, selectedLabel, otherLabel, isManual = true) {
        // Ø§Ú¯Ø± Ú†Ú©â€ŒØ¨Ø§Ú©Ø³ "Ù‡Ù…Ù‡ OK" ÙØ¹Ø§Ù„ Ø§Ø³Øª Ùˆ Ú©Ø§Ø±Ø¨Ø± Ø³Ø¹ÛŒ Ø¯Ø± ØªØºÛŒÛŒØ± Ø¯Ø³ØªÛŒ Ø¯Ø§Ø±Ø¯
        const selectAllCheckbox = document.getElementById('selectAllOkCheckbox');
        if (selectAllCheckbox && selectAllCheckbox.checked && isManual) {
          alert('Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø¯Ø³ØªÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ØŒ Ø§Ø¨ØªØ¯Ø§ ØªÛŒÚ© "Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† OK" Ø±Ø§ Ø¨Ø±Ø¯Ø§Ø±ÛŒØ¯.');
          return;
        }

        if (currentStatus === selectedValue && isManual) {
          selectedLabel.classList.remove('selected');
          selectedLabel.classList.remove('bulk-ok');
          currentStatus = '';
          isBulkOk = false;
        } else {
          // Ø­Ø°Ù Ú©Ù„Ø§Ø³ bulk-ok Ø§Ú¯Ø± ØªØºÛŒÛŒØ± Ø¯Ø³ØªÛŒ Ø§Ø³Øª
          if (isManual && isBulkOk) {
            selectedLabel.classList.remove('bulk-ok');
            isBulkOk = false;
          }
          
          selectedLabel.classList.add('selected');
          otherLabel.classList.remove('selected');
          otherLabel.classList.remove('bulk-ok');
          
          if (!isManual) {
            selectedLabel.classList.add('bulk-ok');
            isBulkOk = true;
            currentStatus = 'bulk-ok';
          } else {
            currentStatus = selectedValue;
          }
        }
        
        const timestamp = nowFa();
        if (!itemMeta[compName]) itemMeta[compName] = {};
        itemMeta[compName][it] = { 
          status: currentStatus, 
          timestamp: currentStatus ? timestamp : '', 
          location: currentStatus ? currentLocation : null 
        };
        
        // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡
        const componentData = allComponentsData[currentIndex];
        if (componentData && componentData.checklist && componentData.checklist[i]) {
          componentData.checklist[i].wasEdited = true;
          if (isFileLoaded && !componentData.checklist[i].wasEdited) {
            editedItemsCount++;
          }
        }
        
        saveCurrentComponentData();
        saveStateToLocalStorage();
        updateProgressDisplay();
      }

      okLabel.addEventListener('click', () => {
        toggleSelection('ok', okLabel, notOkLabel, true);
      });

      notOkLabel.addEventListener('click', () => {
        toggleSelection('notok', notOkLabel, okLabel, true);
      });
      
      note.addEventListener('input', () => {
        // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡
        const componentData = allComponentsData[currentIndex];
        if (componentData && componentData.checklist && componentData.checklist[i]) {
          componentData.checklist[i].wasEdited = true;
          if (isFileLoaded && !componentData.checklist[i].wasEdited) {
            editedItemsCount++;
          }
        }
        
        saveCurrentComponentData();
        saveStateToLocalStorage();
        updateProgressDisplay();
      });
    });
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ Ø¨Ù‡ Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ
    container.appendChild(itemsContainer);
    
    // Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú†Ú©â€ŒØ¨Ø§Ú©Ø³ "Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ OK" Ø¯Ø± Ø§Ù†ØªÙ‡Ø§ (ÙÙ‚Ø· Ø§Ú¯Ø± Ø¢ÛŒØªÙ…ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯)
    if (items.length > 0) {
      const selectAllContainer = document.createElement('div');
      selectAllContainer.innerHTML = createSelectAllCheckbox();
      container.appendChild(selectAllContainer);
      
      // ØªÙ†Ø¸ÛŒÙ… event listener Ø¨Ø±Ø§ÛŒ Ú†Ú©â€ŒØ¨Ø§Ú©Ø³ "Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ OK"
      const selectAllCheckbox = document.getElementById('selectAllOkCheckbox');
      if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function() {
          const checkItems = container.querySelectorAll('.check-item');
          
          if (this.checked) {
            // Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† OK Ú¯Ø±ÙˆÙ‡ÛŒ
            checkItems.forEach((wrap, i) => {
              const okLabel = wrap.querySelector('.ok-opt');
              const notOkLabel = wrap.querySelector('.notok-opt');
              
              if (!okLabel.classList.contains('selected') && !notOkLabel.classList.contains('selected')) {
                toggleSelectionForBulk('ok', okLabel, notOkLabel, i);
              }
            });
          } else {
            // Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ
            checkItems.forEach((wrap, i) => {
              const okLabel = wrap.querySelector('.ok-opt');
              const notOkLabel = wrap.querySelector('.notok-opt');
              
              if (okLabel.classList.contains('bulk-ok')) {
                okLabel.classList.remove('selected');
                okLabel.classList.remove('bulk-ok');
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                const componentData = allComponentsData[currentIndex];
                if (componentData && componentData.checklist && componentData.checklist[i]) {
                  componentData.checklist[i].status = '';
                  componentData.checklist[i].timestamp = '';
                }
              }
            });
            
            saveCurrentComponentData();
            saveStateToLocalStorage();
            updateProgressDisplay();
          }
        });

        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ú¯Ø±ÙˆÙ‡ÛŒ
        function toggleSelectionForBulk(selectedValue, selectedLabel, otherLabel, index) {
          selectedLabel.classList.add('selected');
          selectedLabel.classList.add('bulk-ok');
          otherLabel.classList.remove('selected');
          otherLabel.classList.remove('bulk-ok');
          
          const timestamp = nowFa();
          const itemTitle = items[index];
          if (!itemMeta[compName]) itemMeta[compName] = {};
          itemMeta[compName][itemTitle] = { 
            status: 'bulk-ok', 
            timestamp: timestamp, 
            location: currentLocation 
          };
          
          // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡
          const componentData = allComponentsData[currentIndex];
          if (componentData && componentData.checklist && componentData.checklist[index]) {
            componentData.checklist[index].wasEdited = true;
            componentData.checklist[index].status = 'bulk-ok';
            componentData.checklist[index].timestamp = timestamp;
            
            if (isFileLoaded && !componentData.checklist[index].wasEdited) {
              editedItemsCount++;
            }
          }
          
          // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª
          saveCurrentComponentData();
          saveStateToLocalStorage();
          updateProgressDisplay(); // Ø§ÛŒÙ† Ø®Ø· Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡
        }
      }
    }
  }

  prevBtn.disabled = currentIndex === 0;
  nextBtn.disabled = currentIndex === currentComponents.length - 1;

  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª
  updateProgressDisplay();

  setTimeout(() => {
    try {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      container.scrollTop = 0;
      const first = container.querySelector('.check-item');
      if (first) first.scrollIntoView({ behavior: 'smooth', block: 'start' });
    } catch(e) { console.warn(e); }
  }, 60);
}























    function saveCurrentComponentData() {
      const compName = currentComponents[currentIndex];
      
      if (compName === "Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ") {
        // Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒ
        const vibrationData = saveVibrationData();
        allComponentsData[currentIndex] = { 
          component: compName, 
          vibrationData: vibrationData,
          wasEdited: allComponentsData[currentIndex]?.wasEdited || false
        };
      } else {
        // Ú©Ø¯ Ù‚Ø¨Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ø§Ø¬Ø²Ø§
        const items = checklistItems[compName] || [];
        const rows = container.querySelectorAll('.check-item');
        const checklist = [];
        rows.forEach((w, i) => {
          const title = items[i];
          const note = w.querySelector('.note').value || '';
          const okLabel = w.querySelector('.ok-opt');
          const notOkLabel = w.querySelector('.notok-opt');
          
          let status = '';
          if (okLabel.classList.contains('selected')) {
            status = okLabel.classList.contains('bulk-ok') ? 'bulk-ok' : 'ok';
          } else if (notOkLabel.classList.contains('selected')) {
            status = 'notok';
          }
          
          const meta = (itemMeta[compName] && itemMeta[compName][title]) ? itemMeta[compName][title] : {};
          const wasEdited = allComponentsData[currentIndex]?.checklist?.[i]?.wasEdited || false;
          
          checklist.push({ 
            item: title, 
            status: status, 
            note, 
            timestamp: status ? (meta.timestamp || '') : '', 
            location: status ? (meta.location ?? null) : null,
            wasEdited: wasEdited,
            originalTimestamp: allComponentsData[currentIndex]?.checklist?.[i]?.originalTimestamp || meta.timestamp || ''
          });
        });
        allComponentsData[currentIndex] = { 
          component: compName, 
          checklist,
          wasEdited: allComponentsData[currentIndex]?.wasEdited || false
        };
      }
    }

    nextBtn.addEventListener('click', () => { 
      if (!gpsAccessGranted && !isUserExemptFromGPS()) {
        alert('Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ Ú©Ø§Ø±ØŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª.');
        getLocation();
        return;
      }
      
      saveCurrentComponentData(); 
      saveStateToLocalStorage();
      if (currentIndex < currentComponents.length - 1) loadComponent(currentIndex + 1); 
      else { window.scrollTo({ top: 0, behavior: 'smooth' }); } 
    });

    prevBtn.addEventListener('click', () => { 
      if (!gpsAccessGranted && !isUserExemptFromGPS()) {
        alert('Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ Ú©Ø§Ø±ØŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª.');
        getLocation();
        return;
      }
      
      saveCurrentComponentData(); 
      saveStateToLocalStorage();
      if (currentIndex > 0) loadComponent(currentIndex - 1); 
      else { window.scrollTo({ top: 0, behavior: 'smooth' }); } 
    });

    newFormBtn.addEventListener('click', async () => {
      if (!gpsAccessGranted && !isUserExemptFromGPS()) {
        alert('Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÙØ±Ù…ØŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø¶  ÙˆØ±ÛŒ Ø§Ø³Øª.');
        getLocation();
        return;
      }
      
      saveCurrentComponentData();
      const ok = await doDownloadCurrentForm();
      if (ok) {
        currentEquipment = "";
        currentComponents = [];
        currentIndex = 0;
        allComponentsData = [];
        itemMeta = {};
        currentLocation = null;
        isFileLoaded = false;
        originalFileData = null;
        editedItemsCount = 0;
        page2.style.display = 'none';
        page1.style.display = 'block';
        
        clearStateFromLocalStorage();
        localStorage.removeItem('idlers');
        
        if (geolocationWatchId) {
          navigator.geolocation.clearWatch(geolocationWatchId);
          geolocationWatchId = null;
        }
        
        setTimeout(() => { window.scrollTo({ top: 0, behavior: 'smooth' }); }, 50);
      }
    });

    saveBtn.addEventListener('click', async () => {
      if (!gpsAccessGranted && !isUserExemptFromGPS()) {
        alert('Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù†Ù‡Ø§ÛŒÛŒØŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª.');
        getLocation();
        return;
      }
      
      saveCurrentComponentData();
      const ok = await doDownloadCurrentForm();
      if (ok) {
        alert('ÙØ§ÛŒÙ„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ (Ù¾ÙˆØ´Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¯Ø³ØªÚ¯Ø§Ù‡).');
        clearStateFromLocalStorage();
        currentEquipment = "";
        currentComponents = [];
        currentIndex = 0;
        allComponentsData = [];
        itemMeta = {};
        currentLocation = null;
        isFileLoaded = false;
        originalFileData = null;
        editedItemsCount = 0;
        page2.style.display = 'none';
        page1.style.display = 'block';
        
        if (geolocationWatchId) {
          navigator.geolocation.clearWatch(geolocationWatchId);
          geolocationWatchId = null;
        }
      }
    });

    async function doDownloadCurrentForm() {
      const pid = toEnglishDigits(elId.value.trim());
      const pname = elName.textContent || '---';
      if (!pid || pname === '---') { 
        alert('Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'); 
        return false; 
      }
      if (!currentEquipment) { 
        alert('ØªØ¬Ù‡ÛŒØ² Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡'); 
        return false; 
      }
      
      // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒØ¯Ù„Ø± Ø§Ø² localStorage
      const idlersData = JSON.parse(localStorage.getItem('idlers') || '[]');
      
      // Ø´Ù…Ø§Ø±Ø´ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡
      let editedCount = 0;
      allComponentsData.forEach(component => {
        if (component.checklist) {
          component.checklist.forEach(item => {
            if (item.wasEdited) editedCount++;
          });
        }
        if (component.vibrationData && component.wasEdited) {
          // Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¹Ø§Ø´â€ŒØ³Ù†Ø¬ÛŒØŒ Ø§Ú¯Ø± Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
          editedCount++;
        }
      });
      
      // Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø®Ø´ verification Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯Ù‡
      let verificationSection = null;
      if (isFileLoaded && editedCount > 0) {
        verificationSection = {
          originalDate: originalFileData?.originalDate || originalFileData?.savedAt?.split(' ')[0] || getCurrentDateOnly(),
          editDate: getCurrentDateOnly(),
          editTime: new Date().toLocaleTimeString('fa-IR'),
          editedItemsCount: editedCount,
          isEdited: true
        };
      }
      
      const payload = { 
        personnelId: pid, 
        personnelName: pname, 
        equipment: currentEquipment, 
        savedAt: nowFa(), 
        location: currentLocation,
        components: allComponentsData,
        idlers: idlersData,
        verification: verificationSection
      };
      
      try {
        const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
        const fileNameWithoutExt = currentEquipment + (isFileLoaded ? '_ÙˆÛŒØ±Ø§ÛŒØ´' : '');
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileNameWithoutExt + '.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒØ¯Ù„Ø± Ù¾Ø³ Ø§Ø² Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙÙ‚
        localStorage.removeItem('idlers');
        
        return true;
      } catch(err) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„:', err);
        alert('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„ Ø±Ø® Ø¯Ø§Ø¯.');
        return false;
      }
    }

    function restoreSavedState(state) {
      elId.value = state.personnelId;
      elName.textContent = operators[toEnglishDigits(state.personnelId)] || '---';
      selEquip.value = state.equipment;
      currentEquipment = state.equipment;
      currentComponents = equipmentData[currentEquipment] || [];
      currentIndex = state.currentIndex || 0;
      allComponentsData = state.allComponentsData || [];
      itemMeta = state.itemMeta || {};

      fillComponentsDropdownPage2();
      startGeolocationMonitoring();
      page1.style.display = 'none';
      page2.style.display = 'block';
      loadComponent(currentIndex);
      
      // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª Ù¾Ø³ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
      updateProgressDisplay();
    }

    function startNewForm() {
      clearStateFromLocalStorage();
      elId.value = '';
      elName.textContent = '---';
      selEquip.selectedIndex = 0;
      currentEquipment = "";
      currentComponents = [];
      currentIndex = 0;
      allComponentsData = [];
      itemMeta = {};
      currentLocation = null;
      isFileLoaded = false;
      originalFileData = null;
      editedItemsCount = 0;
      getLocation();
      restoreModal.style.display = 'none';
    }

    // ===== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ =====
    window.addEventListener('load', function() {
      // Ø§ØµÙ„Ø§Ø­ ØªÙˆØ§Ø¨Ø¹ GPS Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù…Ø¹Ø§Ù
      modifyGPSFunctions();
      
      // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„
      setupImportFileFunctionality();
      
      const savedState = checkForSavedState();
      if (savedState) {
        restoreModal.style.display = 'flex';
        
        restoreContinueBtn.addEventListener('click', function() {
          restoreSavedState(savedState);
          restoreModal.style.display = 'none';
        });
        
        restoreNewBtn.addEventListener('click', function() {
          startNewForm();
          restoreModal.style.display = 'none';
        });
      } else {
        getLocation();
      }
    });

    window.addEventListener('beforeunload', function() {
      if (currentEquipment) {
        saveStateToLocalStorage();
      }
      if (geolocationWatchId) {
        navigator.geolocation.clearWatch(geolocationWatchId);
      }
    });

    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'hidden' && currentEquipment) {
        saveStateToLocalStorage();
      }
    });

    if (navigator.permissions) {
      navigator.permissions.query({ name: 'geolocation' }).then(function(permissionStatus) {
        permissionStatus.onchange = function() {
          if (this.state === 'granted') {
            enableFormActions();
            startGeolocationMonitoring();
          } else {
            disableFormActions();
            locationStatus.textContent = "Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ: Ø¯Ø³ØªØ±Ø³ÛŒ Ù„ØºÙˆ Ø´Ø¯";
          }
        };
      });
    }

    // Service Worker (Ø§Ú¯Ø± Ù†ÛŒØ§Ø² Ø¨Ø§Ø´Ø¯)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker Ø«Ø¨Øª Ø´Ø¯'))
        .catch(err => console.error('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Service Worker:', err));
    }
  </script>
</body>
</html>
